# 통합 CMS 데이터베이스 설계

## 📋 문서 정보

- **문서명**: 통합 CMS 데이터베이스 설계
- **버전**: 2.0.0
- **최종 수정일**: 2024-03-25
- **상태**: 최신

---

## 1. 개요

본 문서는 통합 CMS 시스템의 데이터베이스 스키마를 정의합니다. 통합 메타 데이터베이스와 개별 서비스 데이터베이스로 구성되며, 고도화된 권한 시스템(RBAC + ABAC 하이브리드 모델)을 지원합니다.

## 2. 데이터베이스 아키텍처

### 2.1 통합 메타 데이터베이스 (MASTER_DB)

통합 관리를 위한 중앙 집중식 메타데이터를 저장하며, 다음 카테고리로 구성됩니다:

- **서비스 관리**: 개별 서비스 정보 및 연결 정보
- **권한 관리**: 고도화된 관리자 권한 시스템 (RBAC + ABAC)
- **통합 관리**: 서비스별 콘텐츠 통합 관리 및 활동 로그

### 2.2 개별 서비스 데이터베이스 (ServiceN DB)

각 서비스는 독립적인 데이터베이스를 유지하며, 통합 관리를 위한 동기화 메타데이터가 추가됩니다.

## 3. 통합 메타 데이터베이스 스키마

### 3.0 테이블 생성 순서

외래키 의존성을 고려한 테이블 생성 순서는 다음과 같습니다:

```sql
-- 1단계: 기본 테이블 생성 (외래키 의존성 없음)
-- ADMIN_USER (자기 참조 외래키는 나중에 추가)
-- SERVICE

-- 2단계: 참조 테이블 생성
-- ADMIN_GROUP (ADMIN_USER 참조)
-- ROLE (ADMIN_USER 참조)
-- PERMISSION (ADMIN_USER 참조)
-- MENU (SERVICE, ADMIN_USER 참조)

-- 3단계: 매핑 테이블 생성
-- ADMIN_GROUP_MEMBER (ADMIN_GROUP, ADMIN_USER 참조)
-- ADMIN_SERVICE_ROLE (ADMIN_USER, ADMIN_GROUP, SERVICE, ROLE 참조)
-- ADMIN_MENU_PERMISSION (ADMIN_USER, ADMIN_GROUP, MENU 참조)

-- 4단계: 통합 관리 테이블 생성
-- UNIFIED_CONTENT (SERVICE, ADMIN_USER 참조)
-- UNIFIED_ACTIVITY_LOG (ADMIN_USER, SERVICE 참조)

-- 5단계: 자기 참조 외래키 추가
-- ADMIN_USER 자기 참조 외래키 추가
```

### 3.1 서비스 관리 테이블

#### 3.1.1 서비스 정보 테이블 (SERVICE)

각 개별 서비스의 기본 정보와 연결 설정을 관리합니다.

```sql
-- 서비스 정보 테이블
CREATE TABLE SERVICE (
    SERVICE_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '서비스 고유 ID',
    SERVICE_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '서비스 코드 (중복 불가)',
    SERVICE_NAME VARCHAR(100) NOT NULL COMMENT '서비스 이름',
    SERVICE_DOMAIN VARCHAR(255) COMMENT '서비스 도메인 (예: https://example.com)',
    API_BASE_URL VARCHAR(255) COMMENT 'API 기본 URL',
    DB_CONNECTION_INFO TEXT COMMENT '암호화된 DB 접속 정보',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '서비스 상태 (ACTIVE, INACTIVE, MAINTENANCE)',
    DESCRIPTION TEXT COMMENT '서비스 설명',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    CONFIG JSON COMMENT '서비스 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    INDEX idx_service_code (SERVICE_CODE) COMMENT '서비스 코드 검색용 인덱스',
    INDEX idx_status_created (STATUS, CREATED_AT) COMMENT '상태 및 생성일 기반 필터링용 인덱스',
    INDEX idx_domain (SERVICE_DOMAIN) COMMENT '도메인 기반 검색용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 서비스 검색용 인덱스'
);
```

### 3.2 고도화된 권한 관리 테이블

RBAC + ABAC 하이브리드 모델을 지원하는 권한 시스템입니다.

#### 3.2.1 관리자 사용자 테이블 (ADMIN_USER)

```sql
-- 관리자 사용자 테이블
CREATE TABLE ADMIN_USER (
    ADMIN_ID VARCHAR(36) PRIMARY KEY COMMENT '관리자 고유 ID (UUID)',
    USERNAME VARCHAR(50) UNIQUE NOT NULL COMMENT '로그인용 사용자 이름',
    PASSWORD VARCHAR(255) NOT NULL COMMENT 'bcrypt로 해시된 비밀번호',
    NAME VARCHAR(100) NOT NULL COMMENT '이름',
    EMAIL VARCHAR(100) UNIQUE NOT NULL COMMENT '이메일 주소',
    PHONE VARCHAR(50) COMMENT '전화번호',
    DEPARTMENT VARCHAR(100) COMMENT '부서',
    POSITION VARCHAR(100) COMMENT '직책',
    ROLE VARCHAR(20) NOT NULL COMMENT '역할 (SUPER_ADMIN, ADMIN, OPERATOR 등)',
    AVATAR_URL VARCHAR(255) COMMENT '프로필 이미지 URL',
    STATUS VARCHAR(20) NOT NULL DEFAULT 'PENDING_APPROVAL' COMMENT '계정 상태 (ACTIVE, INACTIVE, LOCKED, PENDING_APPROVAL)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    GROUP_ID VARCHAR(36) COMMENT '소속 그룹 ID',
    TEMP_PW_FLAG BOOLEAN DEFAULT FALSE COMMENT '임시비밀번호여부',
    PROVIDER VARCHAR(50) DEFAULT NULL COMMENT '인증 제공자 (OAuth 등)',
    ADDRESS VARCHAR(255) COMMENT '주소',
    RESET_TOKEN VARCHAR(255) COMMENT '비밀번호 재설정 토큰',
    RESET_TOKEN_EXPIRY TIMESTAMP NULL COMMENT '비밀번호 재설정 토큰 만료 시간',
    LAST_LOGIN_AT TIMESTAMP NULL COMMENT '마지막 로그인 시간',
    FAILED_LOGIN_ATTEMPTS INT DEFAULT 0 COMMENT '로그인 실패 횟수',
    PASSWORD_CHANGED_AT TIMESTAMP NULL COMMENT '비밀번호 변경 시각',
    MEMO TEXT COMMENT '관리자 메모',
    MEMO_UPDATED_AT TIMESTAMP NULL COMMENT '메모 최종 수정 일시',
    MEMO_UPDATED_BY VARCHAR(36) COMMENT '메모 최종 수정자 ID',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    INDEX idx_username_status (USERNAME, STATUS) COMMENT '사용자명/상태 기반 검색용 인덱스',
    INDEX idx_email_status (EMAIL, STATUS) COMMENT '이메일/상태 기반 검색용 인덱스',
    INDEX idx_department (DEPARTMENT) COMMENT '부서 기반 검색용 인덱스',
    INDEX idx_last_login (LAST_LOGIN_AT) COMMENT '최근 로그인 기반 검색용 인덱스',
    INDEX idx_created_by (CREATED_BY) COMMENT '생성자 ID 검색용 인덱스',
    INDEX idx_updated_by (UPDATED_BY) COMMENT '수정자 ID 검색용 인덱스',
    FOREIGN KEY (MEMO_UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE
);

-- ADMIN_USER 테이블의 자기 참조 외래키는 테이블 생성 후 별도 추가
ALTER TABLE ADMIN_USER
    ADD CONSTRAINT fk_admin_user_created_by
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL,
    ADD CONSTRAINT fk_admin_user_updated_by
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL;
```

#### 3.2.2 관리자 그룹 테이블 (ADMIN_GROUP)

```sql
-- 관리자 그룹 테이블 (부서, 프로젝트, 커스텀 그룹)
CREATE TABLE ADMIN_GROUP (
    GROUP_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '그룹 고유 ID',
    GROUP_NAME VARCHAR(100) NOT NULL COMMENT '그룹 이름',
    GROUP_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '그룹 코드',
    DESCRIPTION TEXT COMMENT '그룹 설명',
    GROUP_TYPE VARCHAR(20) DEFAULT 'CUSTOM' COMMENT '그룹 유형 (SYSTEM, DEPARTMENT, PROJECT, CUSTOM)',
    PARENT_GROUP_ID int(10) unsigned NULL COMMENT '상위 그룹 ID (계층 구조)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    SERVICE_ID VARCHAR(36) NULL COMMENT '서비스 ID (NULL이면 전체 서비스)',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE)',
    CONFIG JSON COMMENT '그룹 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (PARENT_GROUP_ID) REFERENCES ADMIN_GROUP(GROUP_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '상위 그룹 참조',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    INDEX idx_group_code_type (GROUP_CODE, GROUP_TYPE) COMMENT '그룹 코드/유형 기반 검색용 인덱스',
    INDEX idx_parent_status (PARENT_GROUP_ID, STATUS) COMMENT '상위 그룹/상태 기반 검색용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 그룹 검색용 인덱스',
    INDEX idx_service (SERVICE_ID) COMMENT '서비스별 그룹 검색용 인덱스'
);
```

#### 3.2.3 관리자 그룹 멤버 테이블 (ADMIN_GROUP_MEMBER)

```sql
-- 관리자 그룹 멤버 테이블
CREATE TABLE ADMIN_GROUP_MEMBER (
    MEMBER_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '멤버십 고유 ID',
    GROUP_ID int(10) unsigned NOT NULL COMMENT '그룹 ID',
    ADMIN_ID VARCHAR(36) NOT NULL COMMENT '관리자 ID',
    MEMBER_TYPE VARCHAR(20) DEFAULT 'MEMBER' COMMENT '멤버 유형 (OWNER, ADMIN, MEMBER)',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE, PENDING)',
    JOINED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '가입 시각',
    EXPIRES_AT TIMESTAMP NULL COMMENT '만료 시각',
    PERMISSIONS JSON COMMENT '멤버별 추가 권한 정보',
    CONFIG JSON COMMENT '멤버별 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUP(GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    UNIQUE KEY unique_group_admin (GROUP_ID, ADMIN_ID) COMMENT '그룹-관리자 유일성 제약',
    INDEX idx_member_status (MEMBER_TYPE, STATUS) COMMENT '멤버 유형/상태 기반 검색용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > CREATED_AT) COMMENT '만료일은 생성일보다 이후여야 함'
);
```

#### 3.2.4 역할 정의 테이블 (ROLE)

```sql
-- 역할 정의 테이블
CREATE TABLE ROLE (
    ROLE_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '역할 고유 ID',
    ROLE_NAME VARCHAR(100) NOT NULL COMMENT '역할 이름',
    ROLE_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '역할 코드',
    DESCRIPTION TEXT COMMENT '역할 설명',
    ROLE_TYPE VARCHAR(20) DEFAULT 'CUSTOM' COMMENT '역할 유형 (SYSTEM, SERVICE, CUSTOM)',
    SERVICE_ID VARCHAR(36) NULL COMMENT '서비스 ID (NULL이면 전체 서비스)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE)',
    PERMISSIONS JSON COMMENT '역할에 포함된 권한 목록',
    CONFIG JSON COMMENT '역할 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    INDEX idx_role_code_type (ROLE_CODE, ROLE_TYPE) COMMENT '역할 코드/유형 기반 검색용 인덱스',
    INDEX idx_service_status (SERVICE_ID, STATUS) COMMENT '서비스/상태 기반 검색용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 역할 검색용 인덱스'
);
```

#### 3.2.5 권한 정의 테이블 (PERMISSION)

```sql
-- 권한 정의 테이블
CREATE TABLE PERMISSION (
    PERMISSION_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '권한 고유 ID',
    PERMISSION_NAME VARCHAR(100) NOT NULL COMMENT '권한 이름',
    PERMISSION_CODE VARCHAR(100) UNIQUE NOT NULL COMMENT '권한 코드',
    DESCRIPTION TEXT COMMENT '권한 설명',
    PERMISSION_CATEGORY VARCHAR(50) NOT NULL COMMENT '권한 카테고리 (MENU, FUNCTION, DATA, SYSTEM)',
    RESOURCE_TYPE VARCHAR(50) NOT NULL COMMENT '리소스 타입 (board, content, menu, user 등)',
    ACTION_TYPE VARCHAR(50) NOT NULL COMMENT '액션 타입 (create, read, update, delete, publish 등)',
    SERVICE_ID VARCHAR(36) NULL COMMENT '서비스 ID (NULL이면 전체 서비스)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE)',
    ATTRIBUTES JSON COMMENT '권한 속성 정보 (ABAC용)',
    CONFIG JSON COMMENT '권한 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    INDEX idx_permission_code (PERMISSION_CODE) COMMENT '권한 코드 검색용 인덱스',
    INDEX idx_category_resource_action (PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE) COMMENT '카테고리/리소스/액션 기반 검색용 인덱스',
    INDEX idx_service_status (SERVICE_ID, STATUS) COMMENT '서비스/상태 기반 검색용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 권한 검색용 인덱스'
);
```

#### 3.2.6 메뉴 정의 테이블 (MENU)

```sql
-- 메뉴 정의 테이블 (서비스별 메뉴 구조)
CREATE TABLE MENU (
    -- 기본 정보
    id int(11) NOT NULL AUTO_INCREMENT COMMENT '메뉴 고유 ID',
    name varchar(100) NOT NULL COMMENT '메뉴 이름',
    type enum('LINK','FOLDER','BOARD','CONTENT','PROGRAM') NOT NULL COMMENT '메뉴 타입',
    url varchar(255) DEFAULT NULL COMMENT '링크 URL',
    target_id bigint(20) unsigned DEFAULT NULL COMMENT '연결 대상 ID',
    display_position varchar(50) NOT NULL COMMENT '메뉴 표시 위치',
    sort_order int(11) NOT NULL DEFAULT 0 COMMENT '메뉴 순서',
    parent_id int(11) DEFAULT NULL COMMENT '상위 메뉴 ID',
    
    -- 통합 CMS 필드
    service_id int(10) unsigned NULL COMMENT '서비스 ID',
    menu_code varchar(50) NULL COMMENT '메뉴 코드',
    menu_level int(11) DEFAULT 1 COMMENT '메뉴 레벨',
    visible varchar(20) DEFAULT 'ACTIVE' COMMENT '상태',
    required_permissions JSON NULL COMMENT '필요 권한',
    config JSON NULL COMMENT '설정 정보',
    organization_id varchar(36) NULL COMMENT '기관 ID',
    
    -- 동기화 필드
    unified_menu_id int(10) unsigned NULL COMMENT '통합 메뉴 ID',
    unified_sync_status varchar(20) DEFAULT 'PENDING' COMMENT '동기화 상태',
    unified_sync_message TEXT NULL COMMENT '동기화 메시지',
    unified_last_sync timestamp NULL COMMENT '동기화 시각',
    
    -- 감사 필드
    created_by varchar(36) DEFAULT NULL,
    created_at timestamp NOT NULL DEFAULT current_timestamp(),
    updated_by varchar(36) DEFAULT NULL,
    updated_at timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
    
    -- 제약조건
    PRIMARY KEY (id),
    UNIQUE KEY unique_service_menu_code (service_id, menu_code),
    FOREIGN KEY (service_id) REFERENCES service(id),
    FOREIGN KEY (parent_id) REFERENCES menu(id),
    FOREIGN KEY (created_by) REFERENCES admin_user(uuid),
    FOREIGN KEY (updated_by) REFERENCES admin_user(uuid),
    
    -- 주요 인덱스
    INDEX idx_service_status (service_id, visible),
    INDEX idx_parent_level_order (parent_id, menu_level, sort_order),
    INDEX idx_sync_status (unified_sync_status, unified_last_sync)
);
```

#### 3.2.7 사용자-서비스-역할 매핑 테이블 (ADMIN_SERVICE_ROLE)

```sql
-- 사용자-서비스-역할 매핑 테이블
CREATE TABLE ADMIN_SERVICE_ROLE (
    ASSIGNMENT_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '할당 고유 ID',
    ADMIN_ID VARCHAR(36) NULL COMMENT '관리자 ID',
    GROUP_ID VARCHAR(36) NULL COMMENT '그룹 ID',
    SERVICE_ID int(10) unsigned NULL COMMENT '서비스 ID (NULL이면 통합 시스템)',
    ROLE_ID int(10) unsigned NOT NULL COMMENT '역할 ID',
    ASSIGNMENT_TYPE VARCHAR(20) NOT NULL COMMENT '할당 타입 (USER, GROUP)',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE, PENDING)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    GRANTED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '권한 부여 시간',
    EXPIRES_AT TIMESTAMP NULL COMMENT '권한 만료 시간',
    GRANTED_BY VARCHAR(36) NULL COMMENT '권한 부여자 ID',
    ATTRIBUTES JSON COMMENT '할당 속성 정보',
    CONFIG JSON COMMENT '할당 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUP(GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (ROLE_ID) REFERENCES ROLE(ROLE_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '역할 참조',
    FOREIGN KEY (GRANTED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '권한 부여자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    UNIQUE KEY unique_user_service_role (ADMIN_ID, SERVICE_ID, ROLE_ID) COMMENT '사용자별 서비스 역할 유일성 제약',
    UNIQUE KEY unique_group_service_role (GROUP_ID, SERVICE_ID, ROLE_ID) COMMENT '그룹별 서비스 역할 유일성 제약',
    INDEX idx_admin_service_status (ADMIN_ID, SERVICE_ID, STATUS) COMMENT '관리자별 서비스 권한 조회용 인덱스',
    INDEX idx_group_service_status (GROUP_ID, SERVICE_ID, STATUS) COMMENT '그룹별 서비스 권한 조회용 인덱스',
    INDEX idx_service_role (SERVICE_ID, ROLE_ID) COMMENT '서비스별 역할 조회용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 권한 할당 검색용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (
        (ASSIGNMENT_TYPE = 'USER' AND ADMIN_ID IS NOT NULL AND GROUP_ID IS NULL) OR
        (ASSIGNMENT_TYPE = 'GROUP' AND ADMIN_ID IS NULL AND GROUP_ID IS NOT NULL)
    ) COMMENT '할당 타입에 따른 ID 검증',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > GRANTED_AT) COMMENT '만료일은 부여일보다 이후여야 함'
);
```

#### 3.2.8 사용자별 메뉴 권한 오버라이드 테이블 (ADMIN_MENU_PERMISSION)

```sql
-- 사용자별 메뉴 권한 오버라이드 테이블
CREATE TABLE ADMIN_MENU_PERMISSION (
    MENU_PERMISSION_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '메뉴 권한 고유 ID',
    ADMIN_ID VARCHAR(36) NULL COMMENT '관리자 ID',
    GROUP_ID VARCHAR(36) NULL COMMENT '그룹 ID',
    MENU_ID int(10) unsigned NOT NULL COMMENT '메뉴 ID',
    PERMISSION_TYPE VARCHAR(20) NOT NULL COMMENT '권한 타입 (ALLOW, DENY)',
    ASSIGNMENT_TYPE VARCHAR(20) NOT NULL COMMENT '할당 타입 (USER, GROUP)',
    STATUS VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '상태 (ACTIVE, INACTIVE, PENDING)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    SPECIFIC_PERMISSIONS JSON COMMENT '메뉴 내 세부 기능별 권한',
    ATTRIBUTES JSON COMMENT '권한 속성 정보',
    CONFIG JSON COMMENT '권한 설정 정보',
    GRANTED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '권한 부여 시간',
    EXPIRES_AT TIMESTAMP NULL COMMENT '권한 만료 시간',
    GRANTED_BY VARCHAR(36) NULL COMMENT '권한 부여자 ID',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUP(GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (MENU_ID) REFERENCES MENU(MENU_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '메뉴 참조',
    FOREIGN KEY (GRANTED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '권한 부여자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    UNIQUE KEY unique_user_menu_permission (ADMIN_ID, MENU_ID) COMMENT '사용자별 메뉴 권한 유일성 제약',
    UNIQUE KEY unique_group_menu_permission (GROUP_ID, MENU_ID) COMMENT '그룹별 메뉴 권한 유일성 제약',
    INDEX idx_admin_menu_status (ADMIN_ID, MENU_ID, STATUS) COMMENT '관리자별 메뉴 권한 조회용 인덱스',
    INDEX idx_group_menu_status (GROUP_ID, MENU_ID, STATUS) COMMENT '그룹별 메뉴 권한 조회용 인덱스',
    INDEX idx_menu_permission (MENU_ID, PERMISSION_TYPE) COMMENT '메뉴별 권한 타입 조회용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 메뉴 권한 검색용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (
        (ASSIGNMENT_TYPE = 'USER' AND ADMIN_ID IS NOT NULL AND GROUP_ID IS NULL) OR
        (ASSIGNMENT_TYPE = 'GROUP' AND ADMIN_ID IS NULL AND GROUP_ID IS NOT NULL)
    ) COMMENT '할당 타입에 따른 ID 검증',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > GRANTED_AT) COMMENT '만료일은 부여일보다 이후여야 함'
);
```

### 3.3 통합 관리 테이블

#### 3.3.1 통합 콘텐츠 관리 테이블 (UNIFIED_CONTENT)

```sql
-- 게시판 설정 테이블
CREATE TABLE bbs_master (
  BBS_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'PK: 게시판 ID',
  BBS_NAME varchar(100) NOT NULL COMMENT '게시판 이름',
  SKIN_TYPE enum('BASIC','FAQ','QNA','PRESS','FORM') NOT NULL COMMENT '게시판 스킨 유형',
  READ_AUTH varchar(50) NOT NULL COMMENT '읽기 권한 코드',
  WRITE_AUTH varchar(50) NOT NULL COMMENT '쓰기 권한 코드',
  ADMIN_AUTH varchar(50) NOT NULL COMMENT '관리 권한 코드',
  DISPLAY_YN varchar(1) DEFAULT 'Y' COMMENT '노출 여부',
  SORT_ORDER varchar(1) DEFAULT 'D' COMMENT '게시판 정렬 순서(A=오름차순,D=내림차순)',
  NOTICE_YN varchar(1) DEFAULT 'N' COMMENT '공지 여부(Y=공지,N=미공지)',
  PUBLISH_YN varchar(1) DEFAULT 'N' COMMENT '게시 여부(Y=게시,N=미게시)',
  ATTACHMENT_YN varchar(1) DEFAULT 'N' COMMENT '첨부파일 기능 사용여부',
  ATTACHMENT_LIMIT int(11) DEFAULT 0 COMMENT '첨부파일 최대 개수',
  ATTACHMENT_SIZE int(11) DEFAULT 0 COMMENT '첨부파일 최대 용량(MB)',
  CREATED_BY varchar(36) DEFAULT NULL COMMENT '생성자 ID',
  CREATED_IP varchar(45) DEFAULT NULL COMMENT '생성자 IP',
  CREATED_AT timestamp NOT NULL DEFAULT current_timestamp() COMMENT '생성 시각',
  UPDATED_BY varchar(36) DEFAULT NULL COMMENT '수정자 ID',
  UPDATED_IP varchar(45) DEFAULT NULL COMMENT '수정자 IP',
  UPDATED_AT timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '수정 시각',
  PRIMARY KEY (BBS_ID)
);

-- 게시판 카테고리 테이블
CREATE TABLE bbs_category (
  CATEGORY_ID int(20) unsigned NOT NULL AUTO_INCREMENT,
  BBS_ID int(20) unsigned NOT NULL COMMENT 'FK: 게시판 ID',
  CODE varchar(50) NOT NULL COMMENT '카테고리 코드',
  NAME varchar(100) NOT NULL COMMENT '카테고리 이름',
  SORT_ORDER int(11) DEFAULT 0 COMMENT '카테고리 정렬 순서',
  DISPLAY_YN varchar(1) DEFAULT 'Y' COMMENT '노출 여부(Y,N)',
  CREATED_BY varchar(36) DEFAULT NULL COMMENT '생성자 ID',
  CREATED_IP varchar(45) DEFAULT NULL COMMENT '생성자 IP',
  CREATED_AT timestamp NOT NULL DEFAULT current_timestamp() COMMENT '생성 시각',
  UPDATED_BY varchar(36) DEFAULT NULL COMMENT '수정자 ID',
  UPDATED_IP varchar(45) DEFAULT NULL COMMENT '수정자 IP',
  UPDATED_AT timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '수정 시각',
  PRIMARY KEY (CATEGORY_ID),
  UNIQUE KEY UK_BBS_CATEGORY_CODE (BBS_ID,CODE),
  KEY IDX_CATEGORY_SORT (BBS_ID,SORT_ORDER,DISPLAY_YN),
  CONSTRAINT bbs_category_ibfk_1 FOREIGN KEY (BBS_ID) REFERENCES bbs_master (BBS_ID) ON DELETE CASCADE
);

-- 게시글-카테고리 매핑 테이블
CREATE TABLE bbs_article_category (
  NTT_ID int(20) unsigned NOT NULL COMMENT 'FK: 게시글 ID',
  CATEGORY_ID int(20) unsigned NOT NULL COMMENT 'FK: 카테고리 ID',
  PRIMARY KEY (NTT_ID,CATEGORY_ID),
  KEY IDX_ARTICLE_CATEGORY (CATEGORY_ID,NTT_ID),
  CONSTRAINT bbs_article_category_ibfk_1 FOREIGN KEY (NTT_ID) REFERENCES bbs_article (NTT_ID) ON DELETE CASCADE,
  CONSTRAINT bbs_article_category_ibfk_2 FOREIGN KEY (CATEGORY_ID) REFERENCES bbs_category (CATEGORY_ID) ON DELETE CASCADE
);

-- 게시판 댓글 테이블
CREATE TABLE bbs_comment (
  COMMENT_ID bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'PK: 댓글 ID',
  NTT_ID int(10) unsigned NOT NULL COMMENT 'FK: 게시글 ID',
  CONTENT text NOT NULL COMMENT '댓글 내용',
  WRITER varchar(50) NOT NULL COMMENT '작성자 ID',
  DISPLAY_WRITER varchar(50) DEFAULT NULL COMMENT '표시될 작성자명',
  IS_DELETED char(1) NOT NULL DEFAULT 'N' COMMENT '삭제 여부 (Y/N)',
  CREATED_BY varchar(36) DEFAULT NULL COMMENT '생성자 ID',
  CREATED_IP varchar(45) DEFAULT NULL COMMENT '생성자 IP',
  CREATED_AT timestamp NOT NULL DEFAULT current_timestamp() COMMENT '생성 시각',
  UPDATED_BY varchar(36) DEFAULT NULL COMMENT '수정자 ID',
  UPDATED_IP varchar(45) DEFAULT NULL COMMENT '수정자 IP',
  UPDATED_AT timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '수정 시각',
  PRIMARY KEY (COMMENT_ID),
  KEY idx_voice_comment_ntt_id (NTT_ID),
  CONSTRAINT fk_voice_comment_to_bbs_article FOREIGN KEY (NTT_ID) REFERENCES bbs_article (NTT_ID) ON DELETE CASCADE
);

-- 게시판 게시글 테이블
CREATE TABLE bbs_article (
  NTT_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'PK: 게시글 ID',
  BBS_ID int(10) unsigned NOT NULL COMMENT 'FK: 게시판 ID',
  MENU_ID int(11) NOT NULL COMMENT 'FK: 메뉴 ID',
  PARENT_NTT_ID int(10) unsigned DEFAULT NULL COMMENT '부모 글 ID(답변형)',
  THREAD_DEPTH int(10) unsigned DEFAULT 0 COMMENT '답변 깊이',
  WRITER varchar(50) NOT NULL COMMENT '작성자',
  TITLE varchar(255) NOT NULL COMMENT '제목',
  content text DEFAULT NULL COMMENT '내용',
  NOTICE_STATE varchar(1) DEFAULT 'N' COMMENT '공지 여부(Y=공지,N=미공지,P=영구공지)',
  NOTICE_START_DT datetime DEFAULT curdate() COMMENT '공지 시작일',
  NOTICE_END_DT datetime DEFAULT (curdate() + interval 1 day) COMMENT '공지 종료일',
  PUBLISH_STATE varchar(1) DEFAULT 'N' COMMENT '게시 여부(Y=게시,N=미게시,P=영구게시)',
  PUBLISH_START_DT datetime DEFAULT curdate() COMMENT '게시 시작일',
  PUBLISH_END_DT datetime DEFAULT (curdate() + interval 1 day) COMMENT '게시 종료일',
  EXTERNAL_LINK varchar(255) DEFAULT NULL COMMENT '외부 링크 URL',
  HITS int(11) DEFAULT 0 COMMENT '조회수',
  POSTED_AT datetime NOT NULL DEFAULT current_timestamp() COMMENT '표시용 등록일 (관리자 수정 가능)',
  DISPLAY_WRITER varchar(50) DEFAULT NULL COMMENT '표시용 작성자 (관리자 수정 가능)',
  CREATED_BY varchar(36) DEFAULT NULL COMMENT '생성자 ID',
  CREATED_IP varchar(45) DEFAULT NULL COMMENT '생성자 IP',
  CREATED_AT timestamp NOT NULL DEFAULT current_timestamp() COMMENT '생성 시각',
  UPDATED_BY varchar(36) DEFAULT NULL COMMENT '수정자 ID',
  UPDATED_IP varchar(45) DEFAULT NULL COMMENT '수정자 IP',
  UPDATED_AT timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '수정 시각',
  has_image_in_content tinyint(1) DEFAULT 0 COMMENT '본문 내 이미지 포함 여부',
  PRIMARY KEY (NTT_ID),
  KEY fk_bbs_article_master (BBS_ID),
  KEY fk_bbs_article_parent (PARENT_NTT_ID),
  KEY idx_article_search (TITLE,content(255)),
  KEY fk_bbs_article_menu (MENU_ID),
  CONSTRAINT fk_bbs_article_master FOREIGN KEY (BBS_ID) REFERENCES bbs_master (BBS_ID) ON DELETE CASCADE,
  CONSTRAINT fk_bbs_article_menu FOREIGN KEY (MENU_ID) REFERENCES menu (id) ON DELETE CASCADE,
  CONSTRAINT fk_bbs_article_parent FOREIGN KEY (PARENT_NTT_ID) REFERENCES bbs_article (NTT_ID) ON DELETE SET NULL
);
```

#### 3.3.2 통합 활동 로그 테이블 (UNIFIED_ACTIVITY_LOG)

```sql
-- 통합 활동 로그
CREATE TABLE UNIFIED_ACTIVITY_LOG (
    LOG_ID int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '로그 고유 ID',
    ADMIN_ID VARCHAR(36) NOT NULL COMMENT '작업한 관리자 ID',
    SERVICE_ID VARCHAR(36) NOT NULL COMMENT '대상 서비스 ID',
    ACTION VARCHAR(100) NOT NULL COMMENT '실행된 작업명 (예: update, delete)',
    TARGET_TYPE VARCHAR(50) NOT NULL COMMENT '대상 객체 유형 (예: BOARD, MENU)',
    TARGET_ID int(10) unsigned NOT NULL COMMENT '대상 객체 ID',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    STATUS VARCHAR(20) DEFAULT 'SUCCESS' COMMENT '로그 상태 (SUCCESS, ERROR, WARNING)',
    DETAILS JSON NOT NULL COMMENT '작업 상세 내역(JSON)',
    REQUEST_METHOD VARCHAR(10) NOT NULL COMMENT 'HTTP 메소드',
    REQUEST_PATH VARCHAR(255) NOT NULL COMMENT '요청 경로',
    REQUEST_PARAMS JSON COMMENT '요청 파라미터',
    RESPONSE_STATUS INT NOT NULL COMMENT 'HTTP 응답 상태 코드',
    RESPONSE_MESSAGE VARCHAR(255) COMMENT '응답 메시지',
    EXECUTION_TIME INT NOT NULL COMMENT '실행 시간 (ms)',
    USER_AGENT VARCHAR(255) COMMENT '사용자 에이전트',
    IP_ADDRESS VARCHAR(45) NOT NULL COMMENT '요청자 IP 주소',
    ATTRIBUTES JSON COMMENT '로그 속성 정보',
    CONFIG JSON COMMENT '로그 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE CASCADE ON UPDATE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USER(ADMIN_ID) ON DELETE SET NULL ON UPDATE CASCADE COMMENT '수정자 참조',
    INDEX idx_admin_action_time (ADMIN_ID, ACTION, CREATED_AT) COMMENT '관리자별 작업 이력 조회용 인덱스',
    INDEX idx_service_type_time (SERVICE_ID, TARGET_TYPE, CREATED_AT) COMMENT '서비스별 객체 타입 이력 조회용 인덱스',
    INDEX idx_status_time (STATUS, CREATED_AT) COMMENT '상태별 이력 조회용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 활동 로그 검색용 인덱스',
    INDEX idx_ip_time (IP_ADDRESS, CREATED_AT) COMMENT 'IP별 접근 이력 조회용 인덱스'
);
```

## 4. 개별 서비스 데이터베이스 스키마

### 4.1 기존 테이블 확장

각 서비스는 기존 CMS 구조를 유지하되, 통합 관리를 위한 메타데이터를 추가합니다.

#### 4.1.1 콘텐츠 동기화 메타데이터

```sql
-- 기존 bbs_article 테이블에 통합 관리용 컬럼 추가 (기존 구조 유지)
ALTER TABLE bbs_article
    ADD COLUMN UNIFIED_SYNC_FLAG BOOLEAN DEFAULT FALSE COMMENT '통합 콘텐츠 동기화 여부',
    ADD COLUMN UNIFIED_SYNC_STATUS VARCHAR(20) DEFAULT 'PENDING' COMMENT '동기화 상태 (PENDING, SUCCESS, ERROR)',
    ADD COLUMN UNIFIED_SYNC_MESSAGE TEXT NULL COMMENT '동기화 실패 시 에러 메시지',
    ADD COLUMN UNIFIED_CONTENT_ID int(10) unsigned NULL COMMENT '통합 시스템의 콘텐츠 ID',
    ADD COLUMN UNIFIED_LAST_SYNC TIMESTAMP NULL COMMENT '통합 콘텐츠 최종 동기화 시각',
    ADD COLUMN ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    ADD COLUMN ATTRIBUTES JSON COMMENT '콘텐츠 속성 정보',
    ADD COLUMN CONFIG JSON COMMENT '콘텐츠 설정 정보',
    ADD INDEX idx_unified_sync (UNIFIED_SYNC_FLAG, UNIFIED_SYNC_STATUS) COMMENT '동기화 상태 조회용 인덱스',
    ADD INDEX idx_unified_content (UNIFIED_CONTENT_ID) COMMENT '통합 콘텐츠 ID 조회용 인덱스',
    ADD INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 게시글 검색용 인덱스',
    ADD CHECK (UNIFIED_SYNC_STATUS != 'ERROR' OR UNIFIED_SYNC_MESSAGE IS NOT NULL) COMMENT '동기화 실패 시 에러 메시지 필수';
```

#### 4.1.2 서비스별 관리자 매핑 테이블

```sql
-- 서비스별 관리자 매핑 테이블
CREATE TABLE SERVICE_ADMIN_MAPPING (
    MAPPING_ID VARCHAR(36) PRIMARY KEY COMMENT '매핑 고유 ID (UUID)',
    UNIFIED_ADMIN_ID VARCHAR(36) NOT NULL COMMENT '통합 DB 기준 ADMIN_USER의 ADMIN_ID',
    LOCAL_ADMIN_ID VARCHAR(36) NOT NULL COMMENT '서비스 DB 기준 관리자 ID',
    MAPPING_STATUS VARCHAR(20) DEFAULT 'PENDING' COMMENT '매핑 상태 (ACTIVE, INACTIVE, PENDING)',
    ORGANIZATION_ID VARCHAR(36) COMMENT '소속 기관 ID',
    PERMISSIONS JSON NOT NULL COMMENT '해당 관리자에 대한 권한 정보(JSON)',
    SYNC_STATUS VARCHAR(20) DEFAULT 'PENDING' COMMENT '동기화 상태 (PENDING, SUCCESS, ERROR)',
    SYNC_MESSAGE TEXT NULL COMMENT '동기화 실패 시 에러 메시지',
    LAST_SYNCED_AT TIMESTAMP NULL COMMENT '최종 동기화 시각',
    ATTRIBUTES JSON COMMENT '매핑 속성 정보',
    CONFIG JSON COMMENT '매핑 설정 정보',
    CREATED_BY VARCHAR(36) NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY VARCHAR(36) NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    -- 통합 DB의 ADMIN_USER 테이블을 참조하는 외래키는 개별 서비스 DB에서는 제약조건으로 설정할 수 없음
    -- 애플리케이션 레벨에서 참조 무결성 관리 필요
    UNIQUE KEY unique_admin_mapping (UNIFIED_ADMIN_ID, LOCAL_ADMIN_ID) COMMENT '관리자 매핑 유일성 제약',
    INDEX idx_unified_admin_status (UNIFIED_ADMIN_ID, MAPPING_STATUS) COMMENT '통합 관리자별 매핑 조회용 인덱스',
    INDEX idx_local_admin_status (LOCAL_ADMIN_ID, MAPPING_STATUS) COMMENT '로컬 관리자별 매핑 조회용 인덱스',
    INDEX idx_sync_status (SYNC_STATUS, LAST_SYNCED_AT) COMMENT '동기화 상태 모니터링용 인덱스',
    INDEX idx_organization (ORGANIZATION_ID) COMMENT '기관별 매핑 검색용 인덱스',
    CHECK (SYNC_STATUS != 'ERROR' OR SYNC_MESSAGE IS NOT NULL) COMMENT '동기화 실패 시 에러 메시지 필수'
);
```

## 5. 초기 데이터

### 5.1 시스템 기본 역할

```sql
-- 시스템 기본 역할 생성
INSERT INTO ROLE (ROLE_NAME, ROLE_CODE, DESCRIPTION, ROLE_TYPE, IS_SYSTEM_ROLE) VALUES
('슈퍼 관리자', 'SUPER_ADMIN', '시스템 전체에 대한 모든 권한', 'SYSTEM', TRUE),
('통합 관리자', 'UNIFIED_ADMIN', '통합 관리 시스템의 모든 권한', 'SYSTEM', TRUE),
('서비스 관리자', 'SERVICE_ADMIN', '개별 서비스의 관리 권한', 'SERVICE', TRUE),
('콘텐츠 관리자', 'CONTENT_ADMIN', '콘텐츠 관리 권한', 'SERVICE', TRUE),
('게시판 관리자', 'BOARD_ADMIN', '게시판 관리 권한', 'SERVICE', TRUE),
('메뉴 관리자', 'MENU_ADMIN', '메뉴 관리 권한', 'SERVICE', TRUE),
('사용자 관리자', 'USER_ADMIN', '사용자 관리 권한', 'SERVICE', TRUE),
('운영자', 'OPERATOR', '기본 운영 권한', 'SERVICE', TRUE),
('뷰어', 'VIEWER', '조회 전용 권한', 'SERVICE', TRUE);
```

### 5.2 시스템 기본 그룹

```sql
-- 시스템 기본 그룹 생성
INSERT INTO ADMIN_GROUP (GROUP_NAME, GROUP_CODE, DESCRIPTION, GROUP_TYPE) VALUES
('시스템 관리자', 'SYSTEM_ADMIN', '시스템 전체 관리자 그룹', 'SYSTEM'),
('서비스 관리자', 'SERVICE_ADMIN', '개별 서비스 관리자 그룹', 'SYSTEM'),
('운영자', 'OPERATOR', '일반 운영자 그룹', 'SYSTEM'),
('개발팀', 'DEVELOPMENT', '개발팀 그룹', 'DEPARTMENT'),
('운영팀', 'OPERATION', '운영팀 그룹', 'DEPARTMENT'),
('고객지원팀', 'SUPPORT', '고객지원팀 그룹', 'DEPARTMENT');
```

### 5.3 기본 권한 정의

```sql
-- 시스템 권한
INSERT INTO PERMISSION (PERMISSION_NAME, PERMISSION_CODE, DESCRIPTION, PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE, IS_SYSTEM_PERMISSION) VALUES
('시스템 관리', 'SYSTEM_MANAGE', '시스템 전체 관리 권한', 'SYSTEM', 'system', 'manage', TRUE),
('서비스 관리', 'SERVICE_MANAGE', '서비스 등록/수정/삭제 권한', 'SYSTEM', 'service', 'manage', TRUE),
('관리자 관리', 'ADMIN_MANAGE', '관리자 계정 관리 권한', 'SYSTEM', 'admin', 'manage', TRUE),
('그룹 관리', 'GROUP_MANAGE', '그룹 관리 권한', 'SYSTEM', 'group', 'manage', TRUE),
('역할 관리', 'ROLE_MANAGE', '역할 관리 권한', 'SYSTEM', 'role', 'manage', TRUE),
('권한 관리', 'PERMISSION_MANAGE', '권한 관리 권한', 'SYSTEM', 'permission', 'manage', TRUE),

-- 메뉴 접근 권한
('통합 대시보드 접근', 'MENU_UNIFIED_DASHBOARD', '통합 대시보드 메뉴 접근', 'MENU', 'dashboard', 'access', FALSE),
('서비스 관리 메뉴', 'MENU_SERVICE_MANAGE', '서비스 관리 메뉴 접근', 'MENU', 'service', 'access', FALSE),
('관리자 관리 메뉴', 'MENU_ADMIN_MANAGE', '관리자 관리 메뉴 접근', 'MENU', 'admin', 'access', FALSE),
('콘텐츠 관리 메뉴', 'MENU_CONTENT_MANAGE', '콘텐츠 관리 메뉴 접근', 'MENU', 'content', 'access', FALSE),
('게시판 관리 메뉴', 'MENU_BOARD_MANAGE', '게시판 관리 메뉴 접근', 'MENU', 'board', 'access', FALSE),

-- 기능 권한
('콘텐츠 생성', 'CONTENT_CREATE', '콘텐츠 생성 권한', 'FUNCTION', 'content', 'create', FALSE),
('콘텐츠 조회', 'CONTENT_READ', '콘텐츠 조회 권한', 'FUNCTION', 'content', 'read', FALSE),
('콘텐츠 수정', 'CONTENT_UPDATE', '콘텐츠 수정 권한', 'FUNCTION', 'content', 'update', FALSE),
('콘텐츠 삭제', 'CONTENT_DELETE', '콘텐츠 삭제 권한', 'FUNCTION', 'content', 'delete', FALSE),
('콘텐츠 발행', 'CONTENT_PUBLISH', '콘텐츠 발행 권한', 'FUNCTION', 'content', 'publish', FALSE);
```

## 6. 인덱스 최적화 전략

### 6.1 권한 검증 최적화

- `(ADMIN_ID, SERVICE_ID, IS_ACTIVE)`: 관리자별 서비스 권한 빠른 조회
- `(GROUP_ID, SERVICE_ID, IS_ACTIVE)`: 그룹별 서비스 권한 빠른 조회
- `(PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE)`: 권한 유형별 검색 최적화

### 6.2 메뉴 구조 최적화

- `(PARENT_MENU_ID, MENU_LEVEL, MENU_ORDER)`: 메뉴 트리 구조 조회 최적화
- `(SERVICE_ID, IS_ACTIVE)`: 서비스별 활성 메뉴 조회 최적화

### 6.3 로그 및 감사 최적화

- `(ADMIN_ID, ACTION, CREATED_AT)`: 관리자별 작업 이력 조회 최적화
- `(SERVICE_ID, TARGET_TYPE, CREATED_AT)`: 서비스별 객체 타입 이력 조회 최적화
- `(CREATED_AT)`: 시간 기반 로그 조회 및 파티셔닝 지원

## 7. 보안 고려사항

### 7.1 데이터 암호화

- `DB_CONNECTION_INFO`: AES-256으로 암호화된 개별 서비스 DB 접속 정보
- 민감한 개인정보는 애플리케이션 레벨에서 암호화

### 7.2 접근 제어

- **외래키 제약조건**: 데이터 무결성 보장 및 고아 레코드 방지
  - `ON DELETE CASCADE`: 상위 레코드 삭제 시 하위 레코드 자동 삭제
  - `ON DELETE SET NULL`: 상위 레코드 삭제 시 하위 레코드의 참조 필드를 NULL로 설정
- **CHECK 제약조건**: 비즈니스 규칙 적용
  - 만료일 검증, 할당 타입 검증, 동기화 상태 검증
- **최소 권한 원칙**: DB 계정별 차등 권한 설정
  - 통합 메타 DB: 통합 API 서버만 전체 접근
  - 개별 서비스 DB: 해당 서비스만 접근 가능

### 7.3 감사 추적

- 모든 주요 테이블에 생성자/수정자 추적
- 권한 변경 시 상세 로그 기록
- IP 주소 및 User Agent 정보 저장

## 8. 외래키 제약조건 요약

### 8.1 통합 메타 데이터베이스 외래키 관계

```sql
-- 기본 참조 관계
SERVICE.CREATED_BY -> ADMIN_USER.ADMIN_ID
SERVICE.UPDATED_BY -> ADMIN_USER.ADMIN_ID

ADMIN_USER.CREATED_BY -> ADMIN_USER.ADMIN_ID (자기 참조)
ADMIN_USER.UPDATED_BY -> ADMIN_USER.ADMIN_ID (자기 참조)

ADMIN_GROUP.PARENT_GROUP_ID -> ADMIN_GROUP.GROUP_ID (자기 참조)
ADMIN_GROUP.CREATED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_GROUP.UPDATED_BY -> ADMIN_USER.ADMIN_ID

-- 멤버십 및 권한 관계
ADMIN_GROUP_MEMBER.GROUP_ID -> ADMIN_GROUP.GROUP_ID
ADMIN_GROUP_MEMBER.ADMIN_ID -> ADMIN_USER.ADMIN_ID
ADMIN_GROUP_MEMBER.CREATED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_GROUP_MEMBER.UPDATED_BY -> ADMIN_USER.ADMIN_ID

ROLE.CREATED_BY -> ADMIN_USER.ADMIN_ID
ROLE.UPDATED_BY -> ADMIN_USER.ADMIN_ID

PERMISSION.CREATED_BY -> ADMIN_USER.ADMIN_ID
PERMISSION.UPDATED_BY -> ADMIN_USER.ADMIN_ID

-- 메뉴 구조 관계
MENU.SERVICE_ID -> SERVICE.SERVICE_ID
MENU.PARENT_MENU_ID -> MENU.MENU_ID (자기 참조)
MENU.CREATED_BY -> ADMIN_USER.ADMIN_ID
MENU.UPDATED_BY -> ADMIN_USER.ADMIN_ID

-- 권한 할당 관계
ADMIN_SERVICE_ROLE.ADMIN_ID -> ADMIN_USER.ADMIN_ID
ADMIN_SERVICE_ROLE.GROUP_ID -> ADMIN_GROUP.GROUP_ID
ADMIN_SERVICE_ROLE.SERVICE_ID -> SERVICE.SERVICE_ID
ADMIN_SERVICE_ROLE.ROLE_ID -> ROLE.ROLE_ID
ADMIN_SERVICE_ROLE.GRANTED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_SERVICE_ROLE.CREATED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_SERVICE_ROLE.UPDATED_BY -> ADMIN_USER.ADMIN_ID

ADMIN_MENU_PERMISSION.ADMIN_ID -> ADMIN_USER.ADMIN_ID
ADMIN_MENU_PERMISSION.GROUP_ID -> ADMIN_GROUP.GROUP_ID
ADMIN_MENU_PERMISSION.MENU_ID -> MENU.MENU_ID
ADMIN_MENU_PERMISSION.GRANTED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_MENU_PERMISSION.CREATED_BY -> ADMIN_USER.ADMIN_ID
ADMIN_MENU_PERMISSION.UPDATED_BY -> ADMIN_USER.ADMIN_ID

-- 통합 관리 관계
UNIFIED_CONTENT.SERVICE_ID -> SERVICE.SERVICE_ID
UNIFIED_CONTENT.PARENT_CONTENT_ID -> UNIFIED_CONTENT.CONTENT_ID (자기 참조)
UNIFIED_CONTENT.CREATED_BY -> ADMIN_USER.ADMIN_ID
UNIFIED_CONTENT.UPDATED_BY -> ADMIN_USER.ADMIN_ID

UNIFIED_ACTIVITY_LOG.ADMIN_ID -> ADMIN_USER.ADMIN_ID
UNIFIED_ACTIVITY_LOG.SERVICE_ID -> SERVICE.SERVICE_ID
UNIFIED_ACTIVITY_LOG.CREATED_BY -> ADMIN_USER.ADMIN_ID
UNIFIED_ACTIVITY_LOG.UPDATED_BY -> ADMIN_USER.ADMIN_ID
















```

### 8.2 개별 서비스 데이터베이스 외래키 고려사항

개별 서비스 데이터베이스는 통합 메타 데이터베이스와 물리적으로 분리되어 있어 다음과 같은 제약이 있습니다:

- **크로스 데이터베이스 외래키 불가**: `SERVICE_ADMIN_MAPPING.UNIFIED_ADMIN_ID`는 통합 DB의 `ADMIN_USER.ADMIN_ID`를 참조하지만 물리적 외래키 제약조건 설정 불가
- **애플리케이션 레벨 무결성 관리**: 통합 API 서버에서 참조 무결성을 프로그래밍 방식으로 관리
- **동기화 메타데이터**: `UNIFIED_CONTENT_ID`, `UNIFIED_ADMIN_ID` 등은 논리적 참조로만 관리

---

이 스키마 설계를 통해 통합 CMS의 모든 요구사항을 충족하는 완전한 데이터베이스 구조를 제공할 수 있습니다. 외래키 제약조건이 명확하게 정의되어 데이터 무결성을 보장하고, 테이블 생성 순서를 따라 구현하면 의존성 문제 없이 데이터베이스를 구축할 수 있습니다.
