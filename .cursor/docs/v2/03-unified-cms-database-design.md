# 통합 CMS 데이터베이스 설계

## 📋 문서 정보

- **문서명**: 통합 CMS 데이터베이스 설계
- **버전**: 2.0.0
- **최종 수정일**: 2024-03-25
- **상태**: 최신

---

## 1. 개요

본 문서는 통합 CMS 시스템의 데이터베이스 스키마를 정의합니다. 통합 메타 데이터베이스와 개별 서비스 데이터베이스로 구성되며, 고도화된 권한 시스템(RBAC + ABAC 하이브리드 모델)을 지원합니다.

## 2. 데이터베이스 아키텍처

### 2.1 통합 메타 데이터베이스 (MASTER_DB)

통합 관리를 위한 중앙 집중식 메타데이터를 저장하며, 다음 카테고리로 구성됩니다:

- **서비스 관리**: 개별 서비스 정보 및 연결 정보
- **권한 관리**: 고도화된 관리자 권한 시스템 (RBAC + ABAC)
- **통합 관리**: 서비스별 콘텐츠 통합 관리 및 활동 로그

### 2.2 개별 서비스 데이터베이스 (ServiceN DB)

각 서비스는 독립적인 데이터베이스를 유지하며, 통합 관리를 위한 동기화 메타데이터가 추가됩니다.

## 3. 통합 메타 데이터베이스 스키마

### 3.0 테이블 생성 순서

외래키 의존성을 고려한 테이블 생성 순서는 다음과 같습니다:

```sql
-- 1단계: 기본 테이블 생성 (외래키 의존성 없음)
-- ADMIN_USERS (자기 참조 외래키는 나중에 추가)
-- SERVICES

-- 2단계: 참조 테이블 생성
-- ADMIN_GROUPS (ADMIN_USERS 참조)
-- ROLES (ADMIN_USERS 참조)
-- PERMISSIONS (ADMIN_USERS 참조)
-- MENUS (SERVICES, ADMIN_USERS 참조)

-- 3단계: 매핑 테이블 생성
-- ADMIN_GROUP_MEMBERS (ADMIN_GROUPS, ADMIN_USERS 참조)
-- ADMIN_SERVICE_ROLES (ADMIN_USERS, ADMIN_GROUPS, SERVICES, ROLES 참조)
-- ADMIN_MENU_PERMISSIONS (ADMIN_USERS, ADMIN_GROUPS, MENUS 참조)

-- 4단계: 통합 관리 테이블 생성
-- UNIFIED_CONTENT_MANAGEMENT (SERVICES, ADMIN_USERS 참조)
-- UNIFIED_ACTIVITY_LOGS (ADMIN_USERS, SERVICES 참조)

-- 5단계: 자기 참조 외래키 추가
-- ADMIN_USERS 자기 참조 외래키 추가
```

### 3.1 서비스 관리 테이블

#### 3.1.1 서비스 정보 테이블 (SERVICES)

각 개별 서비스의 기본 정보와 연결 설정을 관리합니다.

```sql
-- 서비스 정보 테이블
CREATE TABLE SERVICES (
    SERVICE_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '서비스 고유 ID',
    SERVICE_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '서비스 코드 (중복 불가)',
    SERVICE_NAME VARCHAR(100) NOT NULL COMMENT '서비스 이름',
    SERVICE_DOMAIN VARCHAR(255) COMMENT '서비스 도메인 (예: https://example.com)',
    API_BASE_URL VARCHAR(255) COMMENT 'API 기본 URL',
    DB_CONNECTION_INFO TEXT COMMENT '암호화된 DB 접속 정보',
    STATUS ENUM('ACTIVE', 'INACTIVE', 'MAINTENANCE') DEFAULT 'ACTIVE' COMMENT '서비스 상태 (활성/비활성/점검)',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    INDEX idx_service_code (SERVICE_CODE) COMMENT '서비스 코드 검색용 인덱스',
    INDEX idx_status_created (STATUS, CREATED_AT) COMMENT '상태 및 생성일 기반 필터링용 인덱스',
    INDEX idx_domain (SERVICE_DOMAIN) COMMENT '도메인 기반 검색용 인덱스'
);
```

### 3.2 고도화된 권한 관리 테이블

RBAC + ABAC 하이브리드 모델을 지원하는 권한 시스템입니다.

#### 3.2.1 관리자 사용자 테이블 (ADMIN_USERS)

```sql
-- 관리자 사용자 테이블
CREATE TABLE ADMIN_USERS (
    ADMIN_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '관리자 고유 ID',
    USERNAME VARCHAR(50) UNIQUE NOT NULL COMMENT '로그인용 사용자 이름',
    PASSWORD VARCHAR(255) NOT NULL COMMENT 'bcrypt로 해시된 비밀번호',
    EMAIL VARCHAR(100) COMMENT '이메일 주소',
    FULL_NAME VARCHAR(100) COMMENT '전체 이름',
    PHONE VARCHAR(20) COMMENT '전화번호',
    DEPARTMENT VARCHAR(100) COMMENT '부서',
    POSITION VARCHAR(100) COMMENT '직책',
    STATUS ENUM('ACTIVE', 'INACTIVE', 'LOCKED', 'PENDING_APPROVAL') DEFAULT 'PENDING_APPROVAL' COMMENT '계정 상태',
    LAST_LOGIN_AT TIMESTAMP NULL COMMENT '마지막 로그인 시간',
    FAILED_LOGIN_ATTEMPTS INT DEFAULT 0 COMMENT '로그인 실패 횟수',
    PASSWORD_CHANGED_AT TIMESTAMP NULL COMMENT '비밀번호 변경 시각',
    TIMEZONE VARCHAR(50) DEFAULT 'Asia/Seoul' COMMENT '시간대',
    LANGUAGE VARCHAR(10) DEFAULT 'ko' COMMENT '언어 설정',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    INDEX idx_username_status (USERNAME, STATUS) COMMENT '사용자명/상태 기반 검색용 인덱스',
    INDEX idx_email_status (EMAIL, STATUS) COMMENT '이메일/상태 기반 검색용 인덱스',
    INDEX idx_department (DEPARTMENT) COMMENT '부서 기반 검색용 인덱스',
    INDEX idx_last_login (LAST_LOGIN_AT) COMMENT '최근 로그인 기반 검색용 인덱스',
    INDEX idx_created_by (CREATED_BY) COMMENT '생성자 ID 검색용 인덱스',
    INDEX idx_updated_by (UPDATED_BY) COMMENT '수정자 ID 검색용 인덱스'
);

-- ADMIN_USERS 테이블의 자기 참조 외래키는 테이블 생성 후 별도 추가
ALTER TABLE ADMIN_USERS
    ADD CONSTRAINT fk_admin_users_created_by
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL,
    ADD CONSTRAINT fk_admin_users_updated_by
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL;
```

#### 3.2.2 관리자 그룹 테이블 (ADMIN_GROUPS)

```sql
-- 관리자 그룹 테이블 (부서, 프로젝트, 커스텀 그룹)
CREATE TABLE ADMIN_GROUPS (
    GROUP_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '그룹 고유 ID',
    GROUP_NAME VARCHAR(100) NOT NULL COMMENT '그룹 이름',
    GROUP_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '그룹 코드',
    DESCRIPTION TEXT COMMENT '그룹 설명',
    GROUP_TYPE ENUM('SYSTEM', 'DEPARTMENT', 'PROJECT', 'CUSTOM') DEFAULT 'CUSTOM' COMMENT '그룹 유형',
    PARENT_GROUP_ID BIGINT NULL COMMENT '상위 그룹 ID (계층 구조)',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (PARENT_GROUP_ID) REFERENCES ADMIN_GROUPS(GROUP_ID) ON DELETE SET NULL COMMENT '상위 그룹 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    INDEX idx_group_code_type (GROUP_CODE, GROUP_TYPE) COMMENT '그룹 코드/유형 기반 검색용 인덱스',
    INDEX idx_parent_active (PARENT_GROUP_ID, IS_ACTIVE) COMMENT '상위 그룹/활성 상태 기반 검색용 인덱스'
);
```

#### 3.2.3 관리자 그룹 멤버 테이블 (ADMIN_GROUP_MEMBERS)

```sql
-- 관리자 그룹 멤버 테이블
CREATE TABLE ADMIN_GROUP_MEMBERS (
    MEMBER_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '멤버십 고유 ID',
    GROUP_ID BIGINT NOT NULL COMMENT '그룹 ID',
    ADMIN_ID BIGINT NOT NULL COMMENT '관리자 ID',
    MEMBER_TYPE ENUM('OWNER', 'ADMIN', 'MEMBER') DEFAULT 'MEMBER' COMMENT '멤버 유형',
    JOINED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '가입 시각',
    EXPIRES_AT TIMESTAMP NULL COMMENT '만료 시각',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUPS(GROUP_ID) ON DELETE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    UNIQUE KEY unique_group_admin (GROUP_ID, ADMIN_ID) COMMENT '그룹-관리자 유일성 제약',
    INDEX idx_member_status (MEMBER_TYPE, IS_ACTIVE) COMMENT '멤버 유형/활성 상태 기반 검색용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > CREATED_AT) COMMENT '만료일은 생성일보다 이후여야 함'
);
```

#### 3.2.4 역할 정의 테이블 (ROLES)

```sql
-- 역할 정의 테이블
CREATE TABLE ROLES (
    ROLE_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '역할 고유 ID',
    ROLE_NAME VARCHAR(100) NOT NULL COMMENT '역할 이름',
    ROLE_CODE VARCHAR(50) UNIQUE NOT NULL COMMENT '역할 코드',
    DESCRIPTION TEXT COMMENT '역할 설명',
    ROLE_TYPE ENUM('SYSTEM', 'SERVICE', 'CUSTOM') DEFAULT 'CUSTOM' COMMENT '역할 유형',
    IS_SYSTEM_ROLE BOOLEAN DEFAULT FALSE COMMENT '시스템 역할 여부',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    INDEX idx_role_code_type (ROLE_CODE, ROLE_TYPE) COMMENT '역할 코드/유형 기반 검색용 인덱스',
    INDEX idx_system_active (IS_SYSTEM_ROLE, IS_ACTIVE) COMMENT '시스템 역할/활성 상태 기반 검색용 인덱스'
);
```

#### 3.2.5 권한 정의 테이블 (PERMISSIONS)

```sql
-- 권한 정의 테이블
CREATE TABLE PERMISSIONS (
    PERMISSION_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '권한 고유 ID',
    PERMISSION_NAME VARCHAR(100) NOT NULL COMMENT '권한 이름',
    PERMISSION_CODE VARCHAR(100) UNIQUE NOT NULL COMMENT '권한 코드',
    DESCRIPTION TEXT COMMENT '권한 설명',
    PERMISSION_CATEGORY VARCHAR(50) NOT NULL COMMENT '권한 카테고리 (MENU, FUNCTION, DATA, SYSTEM)',
    RESOURCE_TYPE VARCHAR(50) NOT NULL COMMENT '리소스 타입 (board, content, menu, user 등)',
    ACTION_TYPE VARCHAR(50) NOT NULL COMMENT '액션 타입 (create, read, update, delete, publish 등)',
    IS_SYSTEM_PERMISSION BOOLEAN DEFAULT FALSE COMMENT '시스템 권한 여부',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    INDEX idx_permission_code (PERMISSION_CODE) COMMENT '권한 코드 검색용 인덱스',
    INDEX idx_category_resource_action (PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE) COMMENT '카테고리/리소스/액션 기반 검색용 인덱스',
    INDEX idx_system_active (IS_SYSTEM_PERMISSION, IS_ACTIVE) COMMENT '시스템 권한/활성 상태 기반 검색용 인덱스'
);
```

#### 3.2.6 메뉴 정의 테이블 (MENUS)

```sql
-- 메뉴 정의 테이블 (서비스별 메뉴 구조)
CREATE TABLE MENUS (
    MENU_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '메뉴 고유 ID',
    SERVICE_ID BIGINT NULL COMMENT '서비스 ID (NULL이면 통합 관리용 메뉴)',
    MENU_CODE VARCHAR(50) NOT NULL COMMENT '메뉴 코드',
    MENU_NAME VARCHAR(100) NOT NULL COMMENT '메뉴 이름',
    MENU_PATH VARCHAR(255) NOT NULL COMMENT '메뉴 경로',
    PARENT_MENU_ID BIGINT NULL COMMENT '상위 메뉴 ID',
    MENU_LEVEL INT DEFAULT 1 COMMENT '메뉴 레벨',
    MENU_ORDER INT DEFAULT 0 COMMENT '메뉴 순서',
    MENU_TYPE ENUM('MENU', 'PAGE', 'FUNCTION', 'BUTTON') DEFAULT 'MENU' COMMENT '메뉴 타입',
    MENU_ICON VARCHAR(100) NULL COMMENT '메뉴 아이콘',
    REQUIRED_PERMISSIONS JSON COMMENT '메뉴 접근에 필요한 권한 목록',
    IS_VISIBLE BOOLEAN DEFAULT TRUE COMMENT '메뉴 표시 여부',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICES(SERVICE_ID) ON DELETE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (PARENT_MENU_ID) REFERENCES MENUS(MENU_ID) ON DELETE CASCADE COMMENT '상위 메뉴 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    UNIQUE KEY unique_service_menu_code (SERVICE_ID, MENU_CODE) COMMENT '서비스별 메뉴 코드 유일성 제약',
    INDEX idx_service_active (SERVICE_ID, IS_ACTIVE) COMMENT '서비스/활성 상태 기반 검색용 인덱스',
    INDEX idx_parent_level_order (PARENT_MENU_ID, MENU_LEVEL, MENU_ORDER) COMMENT '메뉴 구조 조회용 인덱스',
    INDEX idx_menu_path (MENU_PATH) COMMENT '메뉴 경로 검색용 인덱스'
);
```

#### 3.2.7 사용자-서비스-역할 매핑 테이블 (ADMIN_SERVICE_ROLES)

```sql
-- 사용자-서비스-역할 매핑 테이블
CREATE TABLE ADMIN_SERVICE_ROLES (
    ASSIGNMENT_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '할당 고유 ID',
    ADMIN_ID BIGINT NULL COMMENT '관리자 ID',
    GROUP_ID BIGINT NULL COMMENT '그룹 ID',
    SERVICE_ID BIGINT NULL COMMENT '서비스 ID (NULL이면 통합 시스템)',
    ROLE_ID BIGINT NOT NULL COMMENT '역할 ID',
    ASSIGNMENT_TYPE ENUM('USER', 'GROUP') NOT NULL COMMENT '할당 타입',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    GRANTED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '권한 부여 시간',
    EXPIRES_AT TIMESTAMP NULL COMMENT '권한 만료 시간',
    GRANTED_BY BIGINT NULL COMMENT '권한 부여자 ID',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUPS(GROUP_ID) ON DELETE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICES(SERVICE_ID) ON DELETE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (ROLE_ID) REFERENCES ROLES(ROLE_ID) ON DELETE CASCADE COMMENT '역할 참조',
    FOREIGN KEY (GRANTED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '권한 부여자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    UNIQUE KEY unique_user_service_role (ADMIN_ID, SERVICE_ID, ROLE_ID) COMMENT '사용자별 서비스 역할 유일성 제약',
    UNIQUE KEY unique_group_service_role (GROUP_ID, SERVICE_ID, ROLE_ID) COMMENT '그룹별 서비스 역할 유일성 제약',
    INDEX idx_admin_service_active (ADMIN_ID, SERVICE_ID, IS_ACTIVE) COMMENT '관리자별 서비스 권한 조회용 인덱스',
    INDEX idx_group_service_active (GROUP_ID, SERVICE_ID, IS_ACTIVE) COMMENT '그룹별 서비스 권한 조회용 인덱스',
    INDEX idx_service_role (SERVICE_ID, ROLE_ID) COMMENT '서비스별 역할 조회용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (
        (ASSIGNMENT_TYPE = 'USER' AND ADMIN_ID IS NOT NULL AND GROUP_ID IS NULL) OR
        (ASSIGNMENT_TYPE = 'GROUP' AND ADMIN_ID IS NULL AND GROUP_ID IS NOT NULL)
    ) COMMENT '할당 타입에 따른 ID 검증',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > GRANTED_AT) COMMENT '만료일은 부여일보다 이후여야 함'
);
```

#### 3.2.8 사용자별 메뉴 권한 오버라이드 테이블 (ADMIN_MENU_PERMISSIONS)

```sql
-- 사용자별 메뉴 권한 오버라이드 테이블
CREATE TABLE ADMIN_MENU_PERMISSIONS (
    MENU_PERMISSION_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '메뉴 권한 고유 ID',
    ADMIN_ID BIGINT NULL COMMENT '관리자 ID',
    GROUP_ID BIGINT NULL COMMENT '그룹 ID',
    MENU_ID BIGINT NOT NULL COMMENT '메뉴 ID',
    PERMISSION_TYPE ENUM('ALLOW', 'DENY') NOT NULL COMMENT '권한 타입 (허용/거부)',
    ASSIGNMENT_TYPE ENUM('USER', 'GROUP') NOT NULL COMMENT '할당 타입',
    SPECIFIC_PERMISSIONS JSON COMMENT '메뉴 내 세부 기능별 권한',
    IS_ACTIVE BOOLEAN DEFAULT TRUE COMMENT '활성 여부',
    GRANTED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '권한 부여 시간',
    EXPIRES_AT TIMESTAMP NULL COMMENT '권한 만료 시간',
    GRANTED_BY BIGINT NULL COMMENT '권한 부여자 ID',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (GROUP_ID) REFERENCES ADMIN_GROUPS(GROUP_ID) ON DELETE CASCADE COMMENT '그룹 참조',
    FOREIGN KEY (MENU_ID) REFERENCES MENUS(MENU_ID) ON DELETE CASCADE COMMENT '메뉴 참조',
    FOREIGN KEY (GRANTED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '권한 부여자 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    UNIQUE KEY unique_user_menu_permission (ADMIN_ID, MENU_ID) COMMENT '사용자별 메뉴 권한 유일성 제약',
    UNIQUE KEY unique_group_menu_permission (GROUP_ID, MENU_ID) COMMENT '그룹별 메뉴 권한 유일성 제약',
    INDEX idx_admin_menu_active (ADMIN_ID, MENU_ID, IS_ACTIVE) COMMENT '관리자별 메뉴 권한 조회용 인덱스',
    INDEX idx_group_menu_active (GROUP_ID, MENU_ID, IS_ACTIVE) COMMENT '그룹별 메뉴 권한 조회용 인덱스',
    INDEX idx_menu_permission (MENU_ID, PERMISSION_TYPE) COMMENT '메뉴별 권한 타입 조회용 인덱스',
    INDEX idx_expiration (EXPIRES_AT) COMMENT '만료일 기반 검색용 인덱스',
    CHECK (
        (ASSIGNMENT_TYPE = 'USER' AND ADMIN_ID IS NOT NULL AND GROUP_ID IS NULL) OR
        (ASSIGNMENT_TYPE = 'GROUP' AND ADMIN_ID IS NULL AND GROUP_ID IS NOT NULL)
    ) COMMENT '할당 타입에 따른 ID 검증',
    CHECK (EXPIRES_AT IS NULL OR EXPIRES_AT > GRANTED_AT) COMMENT '만료일은 부여일보다 이후여야 함'
);
```

### 3.3 통합 관리 테이블

#### 3.3.1 통합 콘텐츠 관리 테이블 (UNIFIED_CONTENT_MANAGEMENT)

```sql
-- 통합 게시글 관리 뷰
CREATE TABLE UNIFIED_CONTENT_MANAGEMENT (
    CONTENT_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '통합 콘텐츠 ID',
    SERVICE_ID BIGINT NOT NULL COMMENT '원본 서비스 ID',
    ORIGINAL_CONTENT_ID BIGINT NOT NULL COMMENT '원본 콘텐츠 ID (서비스 내 콘텐츠)',
    CONTENT_TYPE ENUM('BOARD', 'POPUP', 'CONTENT', 'MENU') NOT NULL COMMENT '콘텐츠 유형',
    TITLE VARCHAR(255) NOT NULL COMMENT '콘텐츠 제목',
    STATUS VARCHAR(50) NOT NULL DEFAULT 'DRAFT' COMMENT '콘텐츠 상태 (DRAFT, PUBLISHED, DELETED)',
    AUTHOR VARCHAR(100) NOT NULL COMMENT '작성자',
    CONTENT_DATA JSON COMMENT '콘텐츠 메타데이터 (검색용)',
    SYNC_STATUS ENUM('PENDING', 'SUCCESS', 'ERROR') DEFAULT 'PENDING' COMMENT '동기화 상태',
    SYNC_MESSAGE TEXT COMMENT '동기화 실패 시 에러 메시지',
    LAST_SYNCED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '최종 동기화 시각',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICES(SERVICE_ID) ON DELETE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    UNIQUE KEY unique_service_content (SERVICE_ID, CONTENT_TYPE, ORIGINAL_CONTENT_ID) COMMENT '서비스별 콘텐츠 유일성 제약',
    INDEX idx_service_type_status (SERVICE_ID, CONTENT_TYPE, STATUS) COMMENT '서비스/유형/상태별 조회용 인덱스',
    INDEX idx_sync_status (SYNC_STATUS, LAST_SYNCED_AT) COMMENT '동기화 상태 모니터링용 인덱스',
    INDEX idx_title (TITLE) COMMENT '제목 검색용 인덱스',
    INDEX idx_author (AUTHOR) COMMENT '작성자 검색용 인덱스',
    CHECK (SYNC_STATUS != 'ERROR' OR SYNC_MESSAGE IS NOT NULL) COMMENT '동기화 실패 시 에러 메시지 필수'
);
```

#### 3.3.2 통합 활동 로그 테이블 (UNIFIED_ACTIVITY_LOGS)

```sql
-- 통합 활동 로그
CREATE TABLE UNIFIED_ACTIVITY_LOGS (
    LOG_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '로그 고유 ID',
    ADMIN_ID BIGINT NOT NULL COMMENT '작업한 관리자 ID',
    SERVICE_ID BIGINT NOT NULL COMMENT '대상 서비스 ID',
    ACTION VARCHAR(100) NOT NULL COMMENT '실행된 작업명 (예: update, delete)',
    TARGET_TYPE VARCHAR(50) NOT NULL COMMENT '대상 객체 유형 (예: BOARD, MENU)',
    TARGET_ID BIGINT NOT NULL COMMENT '대상 객체 ID',
    DETAILS JSON NOT NULL COMMENT '작업 상세 내역(JSON)',
    REQUEST_METHOD VARCHAR(10) NOT NULL COMMENT 'HTTP 메소드',
    REQUEST_PATH VARCHAR(255) NOT NULL COMMENT '요청 경로',
    REQUEST_PARAMS JSON COMMENT '요청 파라미터',
    RESPONSE_STATUS INT NOT NULL COMMENT 'HTTP 응답 상태 코드',
    RESPONSE_MESSAGE VARCHAR(255) COMMENT '응답 메시지',
    EXECUTION_TIME INT NOT NULL COMMENT '실행 시간 (ms)',
    USER_AGENT VARCHAR(255) COMMENT '사용자 에이전트',
    IP_ADDRESS VARCHAR(45) NOT NULL COMMENT '요청자 IP 주소',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE CASCADE COMMENT '관리자 참조',
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICES(SERVICE_ID) ON DELETE CASCADE COMMENT '서비스 참조',
    FOREIGN KEY (CREATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '생성자 참조',
    FOREIGN KEY (UPDATED_BY) REFERENCES ADMIN_USERS(ADMIN_ID) ON DELETE SET NULL COMMENT '수정자 참조',
    INDEX idx_admin_action_time (ADMIN_ID, ACTION, CREATED_AT) COMMENT '관리자별 작업 이력 조회용 인덱스',
    INDEX idx_service_type_time (SERVICE_ID, TARGET_TYPE, CREATED_AT) COMMENT '서비스별 객체 타입 이력 조회용 인덱스',
    INDEX idx_status_time (RESPONSE_STATUS, CREATED_AT) COMMENT '응답 상태별 이력 조회용 인덱스',
    INDEX idx_ip_time (IP_ADDRESS, CREATED_AT) COMMENT 'IP별 접근 이력 조회용 인덱스'
);
```

## 4. 개별 서비스 데이터베이스 스키마

### 4.1 기존 테이블 확장

각 서비스는 기존 CMS 구조를 유지하되, 통합 관리를 위한 메타데이터를 추가합니다.

#### 4.1.1 콘텐츠 동기화 메타데이터

```sql
-- 기존 테이블에 통합 관리용 컬럼 추가
ALTER TABLE BOARD_ARTICLES
    ADD COLUMN UNIFIED_SYNC_FLAG BOOLEAN DEFAULT FALSE COMMENT '통합 콘텐츠 동기화 여부',
    ADD COLUMN UNIFIED_SYNC_STATUS ENUM('PENDING', 'SUCCESS', 'ERROR') DEFAULT 'PENDING' COMMENT '동기화 상태',
    ADD COLUMN UNIFIED_SYNC_MESSAGE TEXT NULL COMMENT '동기화 실패 시 에러 메시지',
    ADD COLUMN UNIFIED_CONTENT_ID BIGINT NULL COMMENT '통합 시스템의 콘텐츠 ID',
    ADD COLUMN UNIFIED_LAST_SYNC TIMESTAMP NULL COMMENT '통합 콘텐츠 최종 동기화 시각',
    ADD INDEX idx_unified_sync (UNIFIED_SYNC_FLAG, UNIFIED_SYNC_STATUS) COMMENT '동기화 상태 조회용 인덱스',
    ADD INDEX idx_unified_content (UNIFIED_CONTENT_ID) COMMENT '통합 콘텐츠 ID 조회용 인덱스',
    ADD CHECK (UNIFIED_SYNC_STATUS != 'ERROR' OR UNIFIED_SYNC_MESSAGE IS NOT NULL) COMMENT '동기화 실패 시 에러 메시지 필수';
```

#### 4.1.2 서비스별 관리자 매핑 테이블

```sql
-- 서비스별 관리자 매핑 테이블
CREATE TABLE SERVICE_ADMIN_MAPPING (
    MAPPING_ID BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '매핑 고유 ID',
    UNIFIED_ADMIN_ID BIGINT NOT NULL COMMENT '통합 DB 기준 ADMIN_USERS의 ADMIN_ID',
    LOCAL_ADMIN_ID BIGINT NOT NULL COMMENT '서비스 DB 기준 관리자 ID',
    MAPPING_STATUS ENUM('ACTIVE', 'INACTIVE', 'PENDING') DEFAULT 'PENDING' COMMENT '매핑 상태',
    PERMISSIONS JSON NOT NULL COMMENT '해당 관리자에 대한 권한 정보(JSON)',
    SYNC_STATUS ENUM('PENDING', 'SUCCESS', 'ERROR') DEFAULT 'PENDING' COMMENT '동기화 상태',
    SYNC_MESSAGE TEXT NULL COMMENT '동기화 실패 시 에러 메시지',
    LAST_SYNCED_AT TIMESTAMP NULL COMMENT '최종 동기화 시각',
    CREATED_BY BIGINT NULL COMMENT '생성자 ID',
    CREATED_IP VARCHAR(45) NULL COMMENT '생성자 IP',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시각',
    UPDATED_BY BIGINT NULL COMMENT '수정자 ID',
    UPDATED_IP VARCHAR(45) NULL COMMENT '수정자 IP',
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시각',
    -- 통합 DB의 ADMIN_USERS 테이블을 참조하는 외래키는 개별 서비스 DB에서는 제약조건으로 설정할 수 없음
    -- 애플리케이션 레벨에서 참조 무결성 관리 필요
    UNIQUE KEY unique_admin_mapping (UNIFIED_ADMIN_ID, LOCAL_ADMIN_ID) COMMENT '관리자 매핑 유일성 제약',
    INDEX idx_unified_admin (UNIFIED_ADMIN_ID, MAPPING_STATUS) COMMENT '통합 관리자별 매핑 조회용 인덱스',
    INDEX idx_local_admin (LOCAL_ADMIN_ID, MAPPING_STATUS) COMMENT '로컬 관리자별 매핑 조회용 인덱스',
    INDEX idx_sync_status (SYNC_STATUS, LAST_SYNCED_AT) COMMENT '동기화 상태 모니터링용 인덱스',
    INDEX idx_created_by (CREATED_BY) COMMENT '생성자 ID 검색용 인덱스',
    INDEX idx_updated_by (UPDATED_BY) COMMENT '수정자 ID 검색용 인덱스',
    CHECK (SYNC_STATUS != 'ERROR' OR SYNC_MESSAGE IS NOT NULL) COMMENT '동기화 실패 시 에러 메시지 필수'
);
```

## 5. 초기 데이터

### 5.1 시스템 기본 역할

```sql
-- 시스템 기본 역할 생성
INSERT INTO ROLES (ROLE_NAME, ROLE_CODE, DESCRIPTION, ROLE_TYPE, IS_SYSTEM_ROLE) VALUES
('슈퍼 관리자', 'SUPER_ADMIN', '시스템 전체에 대한 모든 권한', 'SYSTEM', TRUE),
('통합 관리자', 'UNIFIED_ADMIN', '통합 관리 시스템의 모든 권한', 'SYSTEM', TRUE),
('서비스 관리자', 'SERVICE_ADMIN', '개별 서비스의 관리 권한', 'SERVICE', TRUE),
('콘텐츠 관리자', 'CONTENT_ADMIN', '콘텐츠 관리 권한', 'SERVICE', TRUE),
('게시판 관리자', 'BOARD_ADMIN', '게시판 관리 권한', 'SERVICE', TRUE),
('메뉴 관리자', 'MENU_ADMIN', '메뉴 관리 권한', 'SERVICE', TRUE),
('사용자 관리자', 'USER_ADMIN', '사용자 관리 권한', 'SERVICE', TRUE),
('운영자', 'OPERATOR', '기본 운영 권한', 'SERVICE', TRUE),
('뷰어', 'VIEWER', '조회 전용 권한', 'SERVICE', TRUE);
```

### 5.2 시스템 기본 그룹

```sql
-- 시스템 기본 그룹 생성
INSERT INTO ADMIN_GROUPS (GROUP_NAME, GROUP_CODE, DESCRIPTION, GROUP_TYPE) VALUES
('시스템 관리자', 'SYSTEM_ADMIN', '시스템 전체 관리자 그룹', 'SYSTEM'),
('서비스 관리자', 'SERVICE_ADMIN', '개별 서비스 관리자 그룹', 'SYSTEM'),
('운영자', 'OPERATOR', '일반 운영자 그룹', 'SYSTEM'),
('개발팀', 'DEVELOPMENT', '개발팀 그룹', 'DEPARTMENT'),
('운영팀', 'OPERATION', '운영팀 그룹', 'DEPARTMENT'),
('고객지원팀', 'SUPPORT', '고객지원팀 그룹', 'DEPARTMENT');
```

### 5.3 기본 권한 정의

```sql
-- 시스템 권한
INSERT INTO PERMISSIONS (PERMISSION_NAME, PERMISSION_CODE, DESCRIPTION, PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE, IS_SYSTEM_PERMISSION) VALUES
('시스템 관리', 'SYSTEM_MANAGE', '시스템 전체 관리 권한', 'SYSTEM', 'system', 'manage', TRUE),
('서비스 관리', 'SERVICE_MANAGE', '서비스 등록/수정/삭제 권한', 'SYSTEM', 'service', 'manage', TRUE),
('관리자 관리', 'ADMIN_MANAGE', '관리자 계정 관리 권한', 'SYSTEM', 'admin', 'manage', TRUE),
('그룹 관리', 'GROUP_MANAGE', '그룹 관리 권한', 'SYSTEM', 'group', 'manage', TRUE),
('역할 관리', 'ROLE_MANAGE', '역할 관리 권한', 'SYSTEM', 'role', 'manage', TRUE),
('권한 관리', 'PERMISSION_MANAGE', '권한 관리 권한', 'SYSTEM', 'permission', 'manage', TRUE),

-- 메뉴 접근 권한
('통합 대시보드 접근', 'MENU_UNIFIED_DASHBOARD', '통합 대시보드 메뉴 접근', 'MENU', 'dashboard', 'access', FALSE),
('서비스 관리 메뉴', 'MENU_SERVICE_MANAGE', '서비스 관리 메뉴 접근', 'MENU', 'service', 'access', FALSE),
('관리자 관리 메뉴', 'MENU_ADMIN_MANAGE', '관리자 관리 메뉴 접근', 'MENU', 'admin', 'access', FALSE),
('콘텐츠 관리 메뉴', 'MENU_CONTENT_MANAGE', '콘텐츠 관리 메뉴 접근', 'MENU', 'content', 'access', FALSE),
('게시판 관리 메뉴', 'MENU_BOARD_MANAGE', '게시판 관리 메뉴 접근', 'MENU', 'board', 'access', FALSE),

-- 기능 권한
('콘텐츠 생성', 'CONTENT_CREATE', '콘텐츠 생성 권한', 'FUNCTION', 'content', 'create', FALSE),
('콘텐츠 조회', 'CONTENT_READ', '콘텐츠 조회 권한', 'FUNCTION', 'content', 'read', FALSE),
('콘텐츠 수정', 'CONTENT_UPDATE', '콘텐츠 수정 권한', 'FUNCTION', 'content', 'update', FALSE),
('콘텐츠 삭제', 'CONTENT_DELETE', '콘텐츠 삭제 권한', 'FUNCTION', 'content', 'delete', FALSE),
('콘텐츠 발행', 'CONTENT_PUBLISH', '콘텐츠 발행 권한', 'FUNCTION', 'content', 'publish', FALSE);
```

## 6. 인덱스 최적화 전략

### 6.1 권한 검증 최적화

- `(ADMIN_ID, SERVICE_ID, IS_ACTIVE)`: 관리자별 서비스 권한 빠른 조회
- `(GROUP_ID, SERVICE_ID, IS_ACTIVE)`: 그룹별 서비스 권한 빠른 조회
- `(PERMISSION_CATEGORY, RESOURCE_TYPE, ACTION_TYPE)`: 권한 유형별 검색 최적화

### 6.2 메뉴 구조 최적화

- `(PARENT_MENU_ID, MENU_LEVEL, MENU_ORDER)`: 메뉴 트리 구조 조회 최적화
- `(SERVICE_ID, IS_ACTIVE)`: 서비스별 활성 메뉴 조회 최적화

### 6.3 로그 및 감사 최적화

- `(ADMIN_ID, ACTION, CREATED_AT)`: 관리자별 작업 이력 조회 최적화
- `(SERVICE_ID, TARGET_TYPE, CREATED_AT)`: 서비스별 객체 타입 이력 조회 최적화
- `(CREATED_AT)`: 시간 기반 로그 조회 및 파티셔닝 지원

## 7. 보안 고려사항

### 7.1 데이터 암호화

- `DB_CONNECTION_INFO`: AES-256으로 암호화된 개별 서비스 DB 접속 정보
- 민감한 개인정보는 애플리케이션 레벨에서 암호화

### 7.2 접근 제어

- **외래키 제약조건**: 데이터 무결성 보장 및 고아 레코드 방지
  - `ON DELETE CASCADE`: 상위 레코드 삭제 시 하위 레코드 자동 삭제
  - `ON DELETE SET NULL`: 상위 레코드 삭제 시 하위 레코드의 참조 필드를 NULL로 설정
- **CHECK 제약조건**: 비즈니스 규칙 적용
  - 만료일 검증, 할당 타입 검증, 동기화 상태 검증
- **최소 권한 원칙**: DB 계정별 차등 권한 설정
  - 통합 메타 DB: 통합 API 서버만 전체 접근
  - 개별 서비스 DB: 해당 서비스만 접근 가능

### 7.3 감사 추적

- 모든 주요 테이블에 생성자/수정자 추적
- 권한 변경 시 상세 로그 기록
- IP 주소 및 User Agent 정보 저장

## 8. 외래키 제약조건 요약

### 8.1 통합 메타 데이터베이스 외래키 관계

```sql
-- 기본 참조 관계
SERVICES.CREATED_BY -> ADMIN_USERS.ADMIN_ID
SERVICES.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

ADMIN_USERS.CREATED_BY -> ADMIN_USERS.ADMIN_ID (자기 참조)
ADMIN_USERS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID (자기 참조)

ADMIN_GROUPS.PARENT_GROUP_ID -> ADMIN_GROUPS.GROUP_ID (자기 참조)
ADMIN_GROUPS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_GROUPS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

-- 멤버십 및 권한 관계
ADMIN_GROUP_MEMBERS.GROUP_ID -> ADMIN_GROUPS.GROUP_ID
ADMIN_GROUP_MEMBERS.ADMIN_ID -> ADMIN_USERS.ADMIN_ID
ADMIN_GROUP_MEMBERS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_GROUP_MEMBERS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

ROLES.CREATED_BY -> ADMIN_USERS.ADMIN_ID
ROLES.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

PERMISSIONS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
PERMISSIONS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

-- 메뉴 구조 관계
MENUS.SERVICE_ID -> SERVICES.SERVICE_ID
MENUS.PARENT_MENU_ID -> MENUS.MENU_ID (자기 참조)
MENUS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
MENUS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

-- 권한 할당 관계
ADMIN_SERVICE_ROLES.ADMIN_ID -> ADMIN_USERS.ADMIN_ID
ADMIN_SERVICE_ROLES.GROUP_ID -> ADMIN_GROUPS.GROUP_ID
ADMIN_SERVICE_ROLES.SERVICE_ID -> SERVICES.SERVICE_ID
ADMIN_SERVICE_ROLES.ROLE_ID -> ROLES.ROLE_ID
ADMIN_SERVICE_ROLES.GRANTED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_SERVICE_ROLES.CREATED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_SERVICE_ROLES.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

ADMIN_MENU_PERMISSIONS.ADMIN_ID -> ADMIN_USERS.ADMIN_ID
ADMIN_MENU_PERMISSIONS.GROUP_ID -> ADMIN_GROUPS.GROUP_ID
ADMIN_MENU_PERMISSIONS.MENU_ID -> MENUS.MENU_ID
ADMIN_MENU_PERMISSIONS.GRANTED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_MENU_PERMISSIONS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
ADMIN_MENU_PERMISSIONS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

-- 통합 관리 관계
UNIFIED_CONTENT_MANAGEMENT.SERVICE_ID -> SERVICES.SERVICE_ID
UNIFIED_CONTENT_MANAGEMENT.CREATED_BY -> ADMIN_USERS.ADMIN_ID
UNIFIED_CONTENT_MANAGEMENT.UPDATED_BY -> ADMIN_USERS.ADMIN_ID

UNIFIED_ACTIVITY_LOGS.ADMIN_ID -> ADMIN_USERS.ADMIN_ID
UNIFIED_ACTIVITY_LOGS.SERVICE_ID -> SERVICES.SERVICE_ID
UNIFIED_ACTIVITY_LOGS.CREATED_BY -> ADMIN_USERS.ADMIN_ID
UNIFIED_ACTIVITY_LOGS.UPDATED_BY -> ADMIN_USERS.ADMIN_ID
```

### 8.2 개별 서비스 데이터베이스 외래키 고려사항

개별 서비스 데이터베이스는 통합 메타 데이터베이스와 물리적으로 분리되어 있어 다음과 같은 제약이 있습니다:

- **크로스 데이터베이스 외래키 불가**: `SERVICE_ADMIN_MAPPING.UNIFIED_ADMIN_ID`는 통합 DB의 `ADMIN_USERS.ADMIN_ID`를 참조하지만 물리적 외래키 제약조건 설정 불가
- **애플리케이션 레벨 무결성 관리**: 통합 API 서버에서 참조 무결성을 프로그래밍 방식으로 관리
- **동기화 메타데이터**: `UNIFIED_CONTENT_ID`, `UNIFIED_ADMIN_ID` 등은 논리적 참조로만 관리

---

이 스키마 설계를 통해 통합 CMS의 모든 요구사항을 충족하는 완전한 데이터베이스 구조를 제공할 수 있습니다. 외래키 제약조건이 명확하게 정의되어 데이터 무결성을 보장하고, 테이블 생성 순서를 따라 구현하면 의존성 문제 없이 데이터베이스를 구축할 수 있습니다.
