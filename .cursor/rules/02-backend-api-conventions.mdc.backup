---
globs: *.java,*.kt,*.sql,*.yml,*.yaml,*.xml
description: í†µí•© CMS v2 ë°±ì—”ë“œ API ê°œë°œ ì»¨ë²¤ì…˜ ë° í‘œì¤€
---

# í†µí•© CMS v2 ë°±ì—”ë“œ API ê°œë°œ ì»¨ë²¤ì…˜

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Core Framework

- **Spring Boot 3.x** + Spring Security 6.x
- **JPA/Hibernate** + HikariCP + AbstractRoutingDataSource
- **í†µí•© ë°±ì—”ë“œ ë¼ìš°íŒ…**: ë‹¨ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ ì„œë¹„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë¼ìš°íŒ…
- **MySQL 8.x** / MariaDB

### ì¸ì¦ ë° ë³´ì•ˆ

- **JWT ê¸°ë°˜ ì¸ì¦**: Access Token (15ë¶„) + Refresh Token (7ì¼)
- **AES-256 ì•”í˜¸í™”**: DB ì—°ê²° ì •ë³´ ë“± ë¯¼ê° ë°ì´í„°
- **ë™ì  ë°ì´í„°ì†ŒìŠ¤**: ServiceContext ê¸°ë°˜ DB ë¼ìš°íŒ…

## ğŸ“ íŒ¨í‚¤ì§€ êµ¬ì¡°

```
src/main/java/cms/
â”œâ”€â”€ config/            # ì„¤ì • í´ë˜ìŠ¤ (ë¼ìš°íŒ…, ë³´ì•ˆ ë“±)
â”‚   â”œâ”€â”€ ServiceContextHolder.java      # ì„œë¹„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬
â”‚   â”œâ”€â”€ ServiceContextInterceptor.java # URL â†’ ì»¨í…ìŠ¤íŠ¸ ë§¤í•‘
â”‚   â””â”€â”€ RoutingDataSourceConfig.java   # ë™ì  DB ë¼ìš°íŒ…
â”œâ”€â”€ common/            # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ auth/              # ì¸ì¦/ì¸ê°€ ê´€ë ¨
â”œâ”€â”€ admin/             # í†µí•© ê´€ë¦¬ì ê´€ë¦¬
â”œâ”€â”€ content/           # ê¸°ì¡´ ì½˜í…ì¸  ê´€ë¦¬ (ì¬ì‚¬ìš©)
â”œâ”€â”€ menu/              # ê¸°ì¡´ ë©”ë‰´ ê´€ë¦¬ (ì¬ì‚¬ìš©)
â”œâ”€â”€ board/             # ê¸°ì¡´ ê²Œì‹œíŒ ê´€ë¦¬ (ì¬ì‚¬ìš©)
â””â”€â”€ user/              # ê¸°ì¡´ ì‚¬ìš©ì ê´€ë¦¬ (ì¬ì‚¬ìš©)
```

## ğŸ”— í†µí•© ë°±ì—”ë“œ ë¼ìš°íŒ… êµ¬í˜„

### 1. ì„œë¹„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬

```java
// ServiceContextHolder: ThreadLocalë¡œ ìš”ì²­ë³„ ì»¨í…ìŠ¤íŠ¸ ë³´ê´€
public final class ServiceContextHolder {
    private static final ThreadLocal<String> CONTEXT = new ThreadLocal<>();

    public static void setCurrentServiceId(String serviceId) {
        CONTEXT.set(serviceId);
    }

    public static String getCurrentServiceId() {
        return CONTEXT.get();
    }

    public static void clear() {
        CONTEXT.remove();
    }
}
```

### 2. URL í”„ë¦¬í”½ìŠ¤ ê¸°ë°˜ ë¼ìš°íŒ… ì¸í„°ì…‰í„°

```java
@Component
public class ServiceContextInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        String path = request.getRequestURI();

        if (path.startsWith("/api/v2/integrated-cms/")) {
            ServiceContextHolder.setCurrentServiceId("integrated_cms");
        } else if (path.startsWith("/api/v2/cms/douzone/")) {
            ServiceContextHolder.setCurrentServiceId("douzone");
        } else if (path.startsWith("/api/v2/cms/service1/")) {
            ServiceContextHolder.setCurrentServiceId("service1");
        } else if (path.startsWith("/api/v2/cms/service2/")) {
            ServiceContextHolder.setCurrentServiceId("service2");
        }
        // /api/v2/integrated-cms/** ëŠ” "integrated_cms" DBë¡œ ë¼ìš°íŒ…
        // /api/v2/cms/{serviceId}/** ëŠ” ê° ì„œë¹„ìŠ¤ë³„ DBë¡œ ë™ì  ë¼ìš°íŒ…
        // í•„ìš”ì‹œ ì¶”ê°€ ì„œë¹„ìŠ¤ ë§¤í•‘

        return true;
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        ServiceContextHolder.clear();
    }
}

// WebConfig: ì¸í„°ì…‰í„° ë“±ë¡
@Configuration
public class WebConfig implements WebMvcConfigurer {

    private final ServiceContextInterceptor interceptor;

    public WebConfig(ServiceContextInterceptor interceptor) {
        this.interceptor = interceptor;
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(interceptor).addPathPatterns("/api/v2/**");
    }
}
```

### 3. ë™ì  ë°ì´í„°ì†ŒìŠ¤ ë¼ìš°íŒ…

```java
@Configuration
public class RoutingDataSourceConfig {

    @Primary
    @Bean
    public DataSource dataSource() {
        ContextRoutingDataSource routingDataSource = new ContextRoutingDataSource();

        Map<Object, Object> targetDataSources = new HashMap<>();
        targetDataSources.put("integrated_cms", integratedCmsDataSource());
        targetDataSources.put("douzone", douzoneDataSource());
        targetDataSources.put("service1", service1DataSource());
        targetDataSources.put("service2", service2DataSource());

        routingDataSource.setTargetDataSources(targetDataSources);
        routingDataSource.setDefaultTargetDataSource(integratedCmsDataSource());

        return routingDataSource;
    }

    @Bean
    public DataSource integratedCmsDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/integrated_cms");
        config.setUsername("integrated.admin");
        config.setPassword(getDecryptedPassword("integrated_cms_password"));
        return new HikariDataSource(config);
    }

    @Bean
    public DataSource douzoneDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/douzone");
        config.setUsername("admin");
        config.setPassword(getDecryptedPassword("douzone_password"));
        return new HikariDataSource(config);
    }

    public static class ContextRoutingDataSource extends AbstractRoutingDataSource {
        @Override
        protected Object determineCurrentLookupKey() {
            return ServiceContextHolder.getCurrentServiceId();
        }
    }
}
```

### 4. ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ ì¬ì‚¬ìš© íŒ¨í„´

```java
// í†µí•© ê´€ë¦¬ API (integrated_cms DB ì ‘ê·¼)
@RestController
@RequestMapping("/api/v2/integrated-cms")
@PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN')")
public class IntegratedCmsController {

    private final AdminUserService adminUserService; // í†µí•© ê´€ë¦¬ì ì„œë¹„ìŠ¤
    private final SystemService systemService; // ì‹œìŠ¤í…œ ê´€ë¦¬ ì„œë¹„ìŠ¤
    private final ServiceManagementService serviceManagementService; // ì„œë¹„ìŠ¤ ê´€ë¦¬

    @PreAuthorize("hasRole('SUPER_ADMIN')")
    @GetMapping("/admins")
    public ResponseEntity<ApiResponseSchema<List<AdminUserDto>>> getAdminUsers() {
        List<AdminUserDto> users = adminUserService.getAllAdminUsers();
        return ResponseEntity.ok(ApiResponseSchema.success(users));
    }

    @GetMapping("/permissions")
    public ResponseEntity<ApiResponseSchema<List<PermissionDto>>> getPermissions() {
        List<PermissionDto> permissions = systemService.getAllPermissions();
        return ResponseEntity.ok(ApiResponseSchema.success(permissions));
    }

    @GetMapping("/services")
    public ResponseEntity<ApiResponseSchema<List<ServiceDto>>> getServices() {
        List<ServiceDto> services = serviceManagementService.getAllServices();
        return ResponseEntity.ok(ApiResponseSchema.success(services));
    }

    @PostMapping("/services")
    @PreAuthorize("hasRole('SUPER_ADMIN')")
    public ResponseEntity<ApiResponseSchema<ServiceDto>> createService(@RequestBody CreateServiceRequest request) {
        ServiceDto service = serviceManagementService.createService(request);
        return ResponseEntity.ok(ApiResponseSchema.success(service, "ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}

// ì„œë¹„ìŠ¤ë³„ CMS API (ê° ì„œë¹„ìŠ¤ DBì— ë™ì  ë¼ìš°íŒ…)
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/content")
@PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN', 'SITE_ADMIN', 'ADMIN')")
public class CmsContentController {

    private final ContentService contentService; // ê¸°ì¡´ Service ì¬ì‚¬ìš©

    @GetMapping
    public ResponseEntity<ApiResponseSchema<Page<ContentDto>>> getContents(
            @PathVariable String serviceId,
            Pageable pageable) {
        // ServiceContextHolderì— ì˜í•´ ìë™ìœ¼ë¡œ {serviceId} DBì— ì—°ê²°ë¨
        Page<ContentDto> contents = contentService.getAllContents(pageable);
        return ResponseEntity.ok(ApiResponseSchema.success(contents));
    }

    @PostMapping
    public ResponseEntity<ApiResponseSchema<ContentDto>> createContent(
            @PathVariable String serviceId,
            @RequestBody ContentDto contentDto) {
        ContentDto created = contentService.createContent(contentDto);
        return ResponseEntity.ok(ApiResponseSchema.success(created, "ì½˜í…ì¸ ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}

// ì„œë¹„ìŠ¤ë³„ ë©”ë‰´ ê´€ë¦¬ API
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/menu")
@PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN', 'SITE_ADMIN', 'ADMIN')")
public class CmsMenuController {

    private final MenuService menuService; // ê¸°ì¡´ Service ì¬ì‚¬ìš©

    @GetMapping
    public ResponseEntity<ApiResponseSchema<List<MenuDto>>> getMenus(@PathVariable String serviceId) {
        List<MenuDto> menus = menuService.getAllMenus();
        return ResponseEntity.ok(ApiResponseSchema.success(menus));
    }

    @PostMapping
    @PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN')")
    public ResponseEntity<ApiResponseSchema<MenuDto>> createMenu(
            @PathVariable String serviceId,
            @RequestBody MenuDto menuDto) {
        MenuDto created = menuService.createMenu(menuDto);
        return ResponseEntity.ok(ApiResponseSchema.success(created, "ë©”ë‰´ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ì›ì¹™

### ê³„ì •ë³„ ì ‘ê·¼ ê¶Œí•œ

```sql
-- integrated.admin: í†µí•© DB + ëª¨ë“  ì„œë¹„ìŠ¤ DB ì ‘ê·¼
CREATE USER 'integrated.admin'@'%' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON integrated_cms.* TO 'integrated.admin'@'%';
GRANT ALL PRIVILEGES ON douzone.* TO 'integrated.admin'@'%';
GRANT ALL PRIVILEGES ON service1.* TO 'integrated.admin'@'%';

-- admin: ì„œë¹„ìŠ¤ë³„ DBë§Œ ì ‘ê·¼
CREATE USER 'admin'@'%' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON douzone.* TO 'admin'@'%';
GRANT ALL PRIVILEGES ON service1.* TO 'admin'@'%';
```

### ê°ì‚¬ í•„ë“œ í‘œì¤€

ëª¨ë“  ì£¼ìš” í…Œì´ë¸”ì— í¬í•¨:

```sql
CREATED_BY VARCHAR(36) NULL,
CREATED_IP VARCHAR(45) NULL,
CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
UPDATED_BY VARCHAR(36) NULL,
UPDATED_IP VARCHAR(45) NULL,
UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
```

## ğŸ“‹ API ì‘ë‹µ í‘œì¤€

### í‘œì¤€ ì‘ë‹µ í˜•ì‹

ëª¨ë“  API ì‘ë‹µì€ `ApiResponseSchema<T>` ì‚¬ìš©:

```java
@RestController
public class ExampleController {

    @GetMapping("/example")
    public ResponseEntity<ApiResponseSchema<ExampleDto>> getExample() {
        ExampleDto data = exampleService.getExample();
        return ResponseEntity.ok(ApiResponseSchema.success(data, "ì¡°íšŒê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
    }

    @PostMapping("/example")
    public ResponseEntity<ApiResponseSchema<ExampleDto>> createExample(@RequestBody ExampleDto dto) {
        ExampleDto created = exampleService.createExample(dto);
        return ResponseEntity.ok(ApiResponseSchema.success(created, "ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}
```

### API ì‘ë‹µ êµ¬ì¡°

```json
{
  "success": true,
  "message": "ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    /* ì‹¤ì œ ë°ì´í„° */
  },
  "errorCode": null,
  "stackTrace": null
}
```

## ğŸ¯ ì—”ë“œí¬ì¸íŠ¸ ë„¤ì´ë° ê·œì¹™

### âš ï¸ ì¤‘ìš”: API ë²„ì „ ì •ì±…

**í†µí•© CMS v2ëŠ” ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ `/api/v2/` í”„ë¦¬í”½ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:**

- âœ… `/api/v2/` - í†µí•© CMS v2 ì „ìš© (í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦, ë™ì  ë¼ìš°íŒ…)
- âŒ `/api/v1/` - êµ¬ ë²„ì „ (v2ì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€)

**ì„¤ì • íŒŒì¼ì—ì„œ í™•ì¸:**

- `WebConfig.java`: `.addPathPrefix("/api/v2", ...)` - ëª¨ë“  @RestControllerì— ìë™ í”„ë¦¬í”½ìŠ¤ ì ìš©
- `SwaggerConfig.java`: `.addServersItem(new Server().url("/api/v2"))`
- `UnifiedCmsSecurityConfig.java`: `.antMatcher("/api/v2/**")`

**âš ï¸ ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì„± ê·œì¹™:**

- ëª¨ë“  `@RestController`ëŠ” **ìƒëŒ€ ê²½ë¡œë§Œ** ì‚¬ìš©í•©ë‹ˆë‹¤ (WebConfigì—ì„œ ìë™ìœ¼ë¡œ `/api/v2` ì¶”ê°€)
- âœ… `@RequestMapping("/integrated-cms")` â†’ ì‹¤ì œ ê²½ë¡œ: `/api/v2/integrated-cms`
- âœ… `@RequestMapping("/cms/{serviceId}/content")` â†’ ì‹¤ì œ ê²½ë¡œ: `/api/v2/cms/{serviceId}/content`
- âŒ `@RequestMapping("/api/v2/integrated-cms")` â†’ ì¤‘ë³µ í”„ë¦¬í”½ìŠ¤ (ì‚¬ìš© ê¸ˆì§€)

**ğŸš¨ í•˜ë“œì½”ë”©ëœ URL ì£¼ì˜ì‚¬í•­:**

- Service í´ë˜ìŠ¤ì˜ íŒŒì¼ URL, ì½œë°± URL ë“±ì—ì„œ `/api/v1` ì‚¬ìš© ê¸ˆì§€
- âœ… `"/api/v2/cms/file/public/view/"` - v2 ì‚¬ìš©
- âŒ `"/api/v1/cms/file/public/view/"` - v1 ì‚¬ìš© ê¸ˆì§€
- ì‘ë‹µ ë©”ì‹œì§€ì˜ endpoint í•„ë“œë„ ìƒëŒ€ê²½ë¡œ ì‚¬ìš©: `"/integrated-cms/admins"`

### í†µí•© ë°±ì—”ë“œ ë¼ìš°íŒ… íŒ¨í„´

```
/api/v2/integrated-cms/**         # í†µí•© ê´€ë¦¬ì, ì‹œìŠ¤í…œ ê¶Œí•œ (integrated_cms DB)
/api/v2/cms/{serviceId}/**        # ì„œë¹„ìŠ¤ë³„ CMS API (ë™ì  DB ë¼ìš°íŒ…)
/api/v2/auth/**                   # ì¸ì¦ ê´€ë ¨
/api/v2/public/**                 # ê³µê°œ API
```

### ì—”ë“œí¬ì¸íŠ¸ ë¼ìš°íŒ… íë¦„

#### í†µí•© ê´€ë¦¬ API ìš”ì²­ ì˜ˆì‹œ

```
1. ìš”ì²­: GET /api/v2/integrated-cms/admins
2. ServiceContextInterceptorê°€ URL ë¶„ì„
3. "/api/v2/integrated-cms/" ì‹œì‘ â†’ ServiceContextHolder.setCurrentServiceId("integrated_cms")
4. Controllerì˜ @RequestMapping("/api/v2/integrated-cms")
5. ì‹¤ì œ ì²˜ë¦¬: @GetMapping("/admins")
6. ìµœì¢… ê²½ë¡œ: /api/v2/integrated-cms + /admins = /api/v2/integrated-cms/admins
```

#### ì„œë¹„ìŠ¤ë³„ CMS API ìš”ì²­ ì˜ˆì‹œ

```
1. ìš”ì²­: GET /api/v2/cms/douzone/content
2. ServiceContextInterceptorê°€ URL ë¶„ì„
3. "douzone" ì¶”ì¶œ â†’ ServiceContextHolder.setCurrentServiceId("douzone")
4. Controllerì˜ @RequestMapping("/api/v2/cms/{serviceId}/content")
5. ì‹¤ì œ ì²˜ë¦¬: @GetMapping (ìƒëŒ€ê²½ë¡œ, ë¹ˆ ë¬¸ìì—´)
6. ìµœì¢… ê²½ë¡œ: /api/v2/cms/douzone/content + "" = /api/v2/cms/douzone/content
```

### RESTful ì„¤ê³„ ì›ì¹™

```java
// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ìƒëŒ€ ê²½ë¡œë§Œ ì§€ì • (@RequestMapping ê¸°ì¤€)
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/content")  // ê¸°ë³¸ ê²½ë¡œ
public class CmsContentController {

    @GetMapping          // "" (ë¹ˆ ë¬¸ìì—´) â†’ /api/v2/cms/{serviceId}/content
    @GetMapping("/{id}") // "/{id}" â†’ /api/v2/cms/{serviceId}/content/{id}
    @PostMapping         // "" (ë¹ˆ ë¬¸ìì—´) â†’ /api/v2/cms/{serviceId}/content
    @PutMapping("/{id}") // "/{id}" â†’ /api/v2/cms/{serviceId}/content/{id}
    @DeleteMapping("/{id}") // "/{id}" â†’ /api/v2/cms/{serviceId}/content/{id}
}
```

## ğŸ” ê¶Œí•œ ê²€ì¦ êµ¬í˜„

### ì—­í•  ê¸°ë°˜ ê¶Œí•œ ì²´í¬

```java
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/content")
public class CmsContentController {

    @PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN', 'SITE_ADMIN', 'ADMIN')")
    @GetMapping
    public ResponseEntity<ApiResponseSchema<Page<ContentDto>>> getContents(
            @PathVariable String serviceId,
            Pageable pageable) {

        Page<ContentDto> contents = contentService.getAllContents(pageable);
        return ResponseEntity.ok(ApiResponseSchema.success(contents));
    }

    @PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN')")
    @PostMapping
    public ResponseEntity<ApiResponseSchema<ContentDto>> createContent(
            @PathVariable String serviceId,
            @RequestBody ContentDto contentDto) {

        ContentDto created = contentService.createContent(contentDto);
        return ResponseEntity.ok(ApiResponseSchema.success(created));
    }
}
```

### ì»¤ìŠ¤í…€ ë³´ì•ˆ ì–´ë…¸í…Œì´ì…˜

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@PreAuthorize("@serviceAccessChecker.hasAccess(authentication, #serviceId)")
public @interface RequireServiceAccess {}

@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@PreAuthorize("hasAnyRole('SUPER_ADMIN', 'SERVICE_ADMIN')")
public @interface ServiceAdminOnly {}
```

## ğŸ’¾ ê¸°ì¡´ Service Layer ì¬ì‚¬ìš©

### Repository íŒ¨í„´ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)

```java
@Repository
public interface ContentRepository extends JpaRepository<Content, Long> {

    @Query("SELECT c FROM Content c WHERE c.status = :status")
    Page<Content> findByStatus(@Param("status") ContentStatus status, Pageable pageable);
}
```

### Service Layer (100% ì¬ì‚¬ìš©)

```java
@Service
@Transactional
public class ContentService {

    @Autowired
    private ContentRepository contentRepository;

    // ê¸°ì¡´ ë©”ì„œë“œë“¤ ê·¸ëŒ€ë¡œ ìœ ì§€
    // ServiceContextHolderì— ì˜í•´ ìë™ìœ¼ë¡œ ì ì ˆí•œ DBì— ì—°ê²°ë¨
    public Page<ContentDto> getAllContents(Pageable pageable) {
        Page<Content> contents = contentRepository.findAll(pageable);
        return contents.map(this::convertToDto);
    }

    public ContentDto createContent(ContentDto dto) {
        Content content = convertToEntity(dto);
        Content saved = contentRepository.save(content);
        return convertToDto(saved);
    }
}
```

## ğŸ“ Swagger/OpenAPI ë¬¸ì„œí™”

### ì»¨íŠ¸ë¡¤ëŸ¬ ë¬¸ì„œí™”

```java
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/content")
@Tag(name = "Content Management", description = "ì½˜í…ì¸  ê´€ë¦¬ API")
@RequireServiceAccess
public class CmsContentController {

    @Operation(summary = "ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ", description = "ì„œë¹„ìŠ¤ë³„ ì½˜í…ì¸  ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.")
    @ApiResponses(value = {
        @ApiResponse(responseCode = "200", description = "ì¡°íšŒ ì„±ê³µ"),
        @ApiResponse(responseCode = "403", description = "ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ"),
        @ApiResponse(responseCode = "404", description = "ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ")
    })
    @GetMapping
    public ResponseEntity<ApiResponseSchema<Page<ContentDto>>> getContents(
            @Parameter(description = "ì„œë¹„ìŠ¤ ID") @PathVariable String serviceId,
            Pageable pageable) {
        // êµ¬í˜„
    }
}
```

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

### ë‹¨ê³„ë³„ ì „í™˜ ê³„íš

```java
// Phase 1: ServiceContextHolder + Interceptor ë„ì…
// Phase 2: RoutingDataSource ì„¤ì •
// Phase 3: ê¸°ì¡´ Controllerë¥¼ ê²½ë¡œë³„ë¡œ ë¶„ê¸°
// Phase 4: í†µí•© ê´€ë¦¬ API ì¶”ê°€

// ì˜ˆì‹œ: PathVariableì„ í†µí•œ ë™ì  ì„œë¹„ìŠ¤ ë¼ìš°íŒ…
@RestController
@RequestMapping("/api/v2/cms/{serviceId}/content")
public class CmsContentController {
    private final ContentService contentService; // ê¸°ì¡´ Service ì¬ì‚¬ìš©

    @GetMapping
    public ResponseEntity<?> getContents(@PathVariable String serviceId, Pageable pageable) {
        // serviceId ê°’ì— ë”°ë¼ ServiceContextInterceptorê°€ ì ì ˆí•œ DBë¡œ ë¼ìš°íŒ…
        return ResponseEntity.ok(contentService.getAllContents(pageable));
    }
}
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### 1. ServiceContext í•„ìˆ˜ ì²´í¬

```java
@Component
public class ServiceContextValidator {

    @EventListener
    public void validateServiceContext(RequestHandledEvent event) {
        String serviceId = ServiceContextHolder.getCurrentServiceId();
        if (serviceId == null && event.getRequestUrl().startsWith("/api/v2/")) {
            log.warn("Missing service context for request: {}", event.getRequestUrl());
        }
    }
}
```

### 2. ë°ì´í„°ì†ŒìŠ¤ ì—°ê²° í™•ì¸

```java
@Component
public class DataSourceHealthCheck {

    @Autowired
    private DataSource dataSource;

    public boolean isHealthy(String serviceId) {
        ServiceContextHolder.setCurrentServiceId(serviceId);
        try (Connection conn = dataSource.getConnection()) {
            return conn.isValid(5);
        } catch (SQLException e) {
            return false;
        } finally {
            ServiceContextHolder.clear();
        }
    }
}
```
