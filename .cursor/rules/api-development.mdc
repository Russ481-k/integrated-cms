---
globs: *.java,*.ts,*.tsx
description: API ê°œë°œ ê°€ì´ë“œë¼ì¸ ë° REST API ì„¤ê³„ ì›ì¹™
---

# API ê°œë°œ ê°€ì´ë“œë¼ì¸

## ğŸŒ API ì„¤ê³„ ì›ì¹™

### RESTful ì„¤ê³„
- **HTTP ë©”ì„œë“œ**: GET (ì¡°íšŒ), POST (ìƒì„±), PUT (ì „ì²´ ìˆ˜ì •), PATCH (ë¶€ë¶„ ìˆ˜ì •), DELETE (ì‚­ì œ)
- **ìƒíƒœ ì½”ë“œ**: 200 (ì„±ê³µ), 201 (ìƒì„±), 400 (ì˜ëª»ëœ ìš”ì²­), 401 (ì¸ì¦ ì‹¤íŒ¨), 403 (ê¶Œí•œ ì—†ìŒ), 404 (ì—†ìŒ), 500 (ì„œë²„ ì˜¤ë¥˜)
- **ë¦¬ì†ŒìŠ¤ ì¤‘ì‹¬**: ëª…ì‚¬ ê¸°ë°˜ URL ì„¤ê³„

### API ê³„ì¸µ êµ¬ì¡°
```
/api/
â”œâ”€â”€ unified/           # í†µí•© ê´€ë¦¬ API
â”‚   â”œâ”€â”€ auth/         # ì¸ì¦/ì¸ê°€
â”‚   â”œâ”€â”€ services/     # ì„œë¹„ìŠ¤ ê´€ë¦¬
â”‚   â”œâ”€â”€ content/      # í†µí•© ì½˜í…ì¸  ê´€ë¦¬
â”‚   â”œâ”€â”€ admins/       # ê´€ë¦¬ì ê³„ì • ê´€ë¦¬
â”‚   â””â”€â”€ system/       # ì‹œìŠ¤í…œ ê´€ë¦¬
â”œâ”€â”€ {serviceCode}/    # ì„œë¹„ìŠ¤ë³„ API (ë™ì )
â””â”€â”€ health/           # í—¬ìŠ¤ì²´í¬
```

## ğŸ” ì¸ì¦ ë° ê¶Œí•œ

### JWT í† í° êµ¬ì¡°
```json
{
  "sub": "admin-uuid",
  "iat": 1234567890,
  "exp": 1234568790,
  "permissions": ["SERVICE_MANAGE", "CONTENT_READ"],
  "services": [1, 2, 3],
  "role": "UNIFIED_ADMIN"
}
```

### ê¶Œí•œ ê²€ì¦ ì–´ë…¸í…Œì´ì…˜
```java
// ì„œë¹„ìŠ¤ ê´€ë¦¬ ê¶Œí•œ í™•ì¸
@PreAuthorize("hasPermission(#serviceId, 'SERVICE', 'MANAGE')")
@PutMapping("/api/unified/services/{serviceId}")

// ë©”ë‰´ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
@PreAuthorize("hasMenuPermission(#menuId, 'ACCESS')")
@GetMapping("/api/unified/menus/{menuId}")

// ê·¸ë£¹ ë©¤ë²„ì‹­ í™•ì¸
@PreAuthorize("isGroupMember(#groupId) or hasRole('SUPER_ADMIN')")
@PostMapping("/api/unified/groups/{groupId}/members")
```

## ğŸ“ API ì‘ë‹µ í˜•ì‹

### í‘œì¤€ ì‘ë‹µ êµ¬ì¡°
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  pagination?: {
    page: number;
    size: number;
    total: number;
    totalPages: number;
  };
  timestamp: string;
}
```

### ì—ëŸ¬ ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "success": false,
  "error": {
    "code": "PERMISSION_DENIED",
    "message": "í•´ë‹¹ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.",
    "details": {
      "serviceId": 1,
      "requiredPermission": "SERVICE_MANAGE"
    }
  },
  "timestamp": "2024-03-25T10:30:00Z"
}
```

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### í˜ì´ì§€ë„¤ì´ì…˜
```java
@GetMapping("/api/unified/content")
public ResponseEntity<ApiResponse<Page<UnifiedContent>>> getContent(
    @RequestParam(defaultValue = "0") int page,
    @RequestParam(defaultValue = "20") int size,
    @RequestParam(required = false) Long serviceId
) {
    // êµ¬í˜„
}
```

### ìºì‹± ì „ëµ
```java
@Cacheable(value = "permissions", key = "#adminId + '_' + #serviceId")
public List<Permission> getUserPermissions(String adminId, Long serviceId) {
    // ê¶Œí•œ ì¡°íšŒ ë¡œì§
}
```

### ì¼ê´„ ì²˜ë¦¬ API
```java
@PostMapping("/api/unified/content/bulk")
public ResponseEntity<?> bulkUpdateContent(
    @RequestBody BulkUpdateRequest request
) {
    // action: "publish", "delete", "move", "sync"
    // ids: [1, 2, 3, 4, 5]
    // targetServiceId: 2 (ì´ë™ ì‹œ)
}
```

## ğŸ”„ ë™ê¸°í™” API

### ì„œë¹„ìŠ¤ ê°„ ì½˜í…ì¸  ë™ê¸°í™”
```java
@PostMapping("/api/unified/content/{contentId}/sync")
public ResponseEntity<?> syncContent(
    @PathVariable Long contentId,
    @RequestParam List<Long> targetServiceIds
) {
    // ë¹„ë™ê¸° ë™ê¸°í™” ì‘ì—… ì‹œì‘
    return ResponseEntity.accepted().build();
}

@GetMapping("/api/unified/content/{contentId}/sync/status")
public ResponseEntity<SyncStatus> getSyncStatus(@PathVariable Long contentId) {
    // ë™ê¸°í™” ìƒíƒœ ì¡°íšŒ
}
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### í™œë™ ë¡œê·¸ ê¸°ë¡
```java
@PostMapping("/api/unified/services")
@LogActivity(action = "SERVICE_CREATE", target = "SERVICE")
public ResponseEntity<?> createService(@RequestBody ServiceRequest request) {
    // ì„œë¹„ìŠ¤ ìƒì„± ë¡œì§
    // ìë™ìœ¼ë¡œ UNIFIED_ACTIVITY_LOGì— ê¸°ë¡
}
```

### í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
```java
@GetMapping("/api/health")
public ResponseEntity<HealthStatus> healthCheck() {
    return ResponseEntity.ok(HealthStatus.builder()
        .status("UP")
        .database("UP")
        .redis("UP")
        .services(serviceHealthChecker.checkAllServices())
        .build());
}
```

ìì„¸í•œ API ëª…ì„¸ëŠ” [04-unified-cms-api-specification.md](mdc:.cursor/docs/v2/04-unified-cms-api-specification.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.